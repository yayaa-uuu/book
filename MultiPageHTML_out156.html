<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_162.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_162.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:7.7712em;top:4.5292em;"><span class="stl_200 stl_171 stl_28">... omitted ... &nbsp;</span></div>
					<div class="stl_01" style="left:7.417em;top:5.3792em;"><span class="stl_200 stl_171 stl_28">) ENGINE=InnoDB; &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:6.5166em;z-index:130;"><span class="stl_154 stl_32 stl_52" style="word-spacing:0.2021em;">We </span><span class="stl_154 stl_32 stl_28">t</span><span class="stl_154 stl_32 stl_189" style="word-spacing:0.007em;">hen measured the performance of joining the tables by the primary key columns. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:7.5666em;"><span class="stl_154 stl_32 stl_126" style="word-spacing:-0.0005em;">Here is the query we used: &nbsp;</span></div>
					<div class="stl_01" style="left:7.4164em;top:9.3285em;"><span class="stl_200 stl_171 stl_28">mysql&gt; </span><span class="stl_265 stl_173 stl_28">SELECT SQL_NO_CACHE COUNT(*) &nbsp;</span></div>
					<div class="stl_01" style="left:8.833em;top:10.1785em;"><span class="stl_200 stl_171 stl_28">-&gt; </span><span class="stl_265 stl_173 stl_28">FROM webservicecalls &nbsp;</span></div>
					<div class="stl_01" style="left:8.833em;top:11.0285em;"><span class="stl_200 stl_171 stl_28">-&gt; </span><span class="stl_265 stl_173 stl_28">JOIN webservicecalls USING(day, account, service, method); &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:12.216em;z-index:328;"><span class="stl_154 stl_32 stl_52" style="word-spacing:0.3298em;">We </span><span class="stl_154 stl_32 stl_28">v</span><span class="stl_154 stl_32 stl_133" style="word-spacing:0.1324em;">aried this query to join the </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1181em;">VARCHAR </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1358em;">and </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1181em;">ENUM </span><span class="stl_154 stl_32 stl_95" style="word-spacing:0.1376em;">columns in different combina‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:13.266em;z-index:400;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">tions. </span><a href="MultiPageHTML_out156.html#156_0"><span class="stl_184 stl_32 stl_127">T</span></a><a href="MultiPageHTML_out156.html#156_0"><span class="stl_184 stl_32 stl_28">a</span></a><a href="MultiPageHTML_out156.html#156_0"><span class="stl_184 stl_32 stl_28" style="word-spacing:0em;">ble 6-1 </span></a><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">shows the results.</span><sup style="top: -0.2917em;"><a href="MultiPageHTML_out156.html#156_1"><span class="stl_166 stl_32 stl_28" style="word-spacing:0em;">3 &nbsp;</span></a></sup></div>
					<div class="stl_01" style="left:6em;top:15.3536em;"><span class="stl_40 stl_41 stl_283" style="word-spacing:0.0267em;">Table 6-1. Speed of joining </span><span class="stl_286 stl_175 stl_28">VARCHA</span><span class="stl_286 stl_175 stl_295">R</span><span class="stl_40 stl_41 stl_22" style="word-spacing:0.023em;">and </span><span class="stl_286 stl_175 stl_28">ENU</span><span class="stl_286 stl_175 stl_295">M</span><span class="stl_40 stl_41 stl_201">columns &nbsp;</span></div>
					<div class="stl_01" style="left:6.3003em;top:16.9259em;"><span class="stl_205 stl_27 stl_28">Test &nbsp;</span></div>
					<div class="stl_01" style="left:14.2069em;top:16.9259em;"><span class="stl_205 stl_27 stl_28" style="word-spacing:0.033em;">Queries per second &nbsp;</span></div>
					<div class="stl_01" style="left:14.2064em;top:18.0024em;"><span class="stl_206 stl_68 stl_28">2.6 &nbsp;</span></div>
					<div class="stl_01" style="left:14.2065em;top:19.1111em;"><span class="stl_206 stl_68 stl_28">1.7 &nbsp;</span></div>
					<div class="stl_01" style="left:14.2067em;top:20.2199em;"><span class="stl_206 stl_68 stl_28">1.8 &nbsp;</span></div>
					<div class="stl_01" style="left:14.2063em;top:21.3286em;"><span class="stl_206 stl_68 stl_28">3.5 &nbsp;</span></div>
					<div class="stl_01" style="left:6.2997em;top:18.0236em;"><span class="stl_200 stl_171 stl_28">VARCHA</span><span class="stl_200 stl_171 stl_288">R</span><span class="stl_206 stl_68 stl_28" style="word-spacing:0.033em;">joined to </span><span class="stl_200 stl_171 stl_28">VARCHAR &nbsp;</span></div>
					<div class="stl_01" style="left:6.3003em;top:19.1324em;"><span class="stl_200 stl_171 stl_28">VARCHA</span><span class="stl_200 stl_171 stl_287">R</span><span class="stl_206 stl_68 stl_28" style="word-spacing:0.0335em;">joined to </span><span class="stl_200 stl_171 stl_28">ENUM &nbsp;</span></div>
					<div class="stl_01" style="left:6.2997em;top:20.2411em;"><span class="stl_200 stl_171 stl_28">ENU</span><span class="stl_200 stl_171 stl_288">M</span><span class="stl_206 stl_68 stl_28" style="word-spacing:0.033em;">joined to </span><span class="stl_200 stl_171 stl_28">VARCHAR &nbsp;</span></div>
					<div class="stl_01" style="left:6.2999em;top:21.3499em;"><span class="stl_200 stl_171 stl_28">ENU</span><span class="stl_200 stl_171 stl_287">M</span><span class="stl_206 stl_68 stl_28" style="word-spacing:0.0335em;">joined to </span><span class="stl_200 stl_171 stl_28">ENUM &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:23.3671em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0367em;">The join is faster after converting the columns to </span><span class="stl_170 stl_171 stl_28">ENUM</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0353em;">, but joining the </span><span class="stl_170 stl_171 stl_28">ENU</span><span class="stl_170 stl_171 stl_392">M</span><span class="stl_154 stl_32 stl_28">columns &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:24.4666em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0782em;">to </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1788em;">VARCHAR </span><span class="stl_154 stl_32 stl_36" style="word-spacing:0.0819em;">columns is slower. In this case, it looks like a good idea to convert these &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:25.566em;"><span class="stl_154 stl_32 stl_107" style="word-spacing:0.0761em;">columns, as long as they don’t have to be joined to </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1903em;">VARCHAR </span><span class="stl_154 stl_32 stl_393" style="word-spacing:0.0886em;">columns. It’s a common &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:26.616em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.2492em;">design practice to use “lookup tables” with integer primary keys to avoid using &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:27.666em;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.0019em;">character-based values in joins. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:29.216em;"><span class="stl_154 stl_32 stl_85" style="word-spacing:0.3808em;">However, there’s another benefit to converting the columns: according to the &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:30.3154em;"><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.0763em;">Data_length </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1755em;">column from </span><span class="stl_170 stl_171 stl_28" style="word-spacing:0.1755em;">SHOW TABLE STATUS</span><span class="stl_154 stl_32 stl_73" style="word-spacing:0.1776em;">, converting these two columns to &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:31.4149em;"><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1875em;">ENUM </span><span class="stl_154 stl_32 stl_97" style="word-spacing:0.0729em;">made the table about one-third smaller. In some cases, this might be beneficial &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:32.5143em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1116em;">even if the </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1436em;">ENUM </span><span class="stl_154 stl_32 stl_57" style="word-spacing:0.1137em;">columns have to be joined to </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1436em;">VARCHAR </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1116em;">columns. Also, the primary &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:33.5643em;"><span class="stl_154 stl_32 stl_140" style="word-spacing:0.0892em;">key itself is only about half the size after the conversion. Because this is an InnoDB &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:34.6143em;"><span class="stl_154 stl_32 stl_117" style="word-spacing:0.0766em;">table, if there are any other indexes on this table, reducing the primary key size will &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:35.6643em;"><span class="stl_154 stl_32 stl_81" style="word-spacing:0.0117em;">make them much smaller, too. &nbsp;</span></div>
					<div class="stl_01" style="left:11.3993em;top:38.0217em;"><span class="stl_176 stl_32 stl_28" style="word-spacing:0.3133em;">While </span><span class="stl_212 stl_171 stl_28" style="word-spacing:0.0687em;">ENUM </span><span class="stl_176 stl_32 stl_126" style="word-spacing:0.3127em;">types are very efficient in how they store values, &nbsp;</span></div>
					<div class="stl_01" style="left:11.3993em;top:39.0269em;"><span class="stl_176 stl_32 stl_78" style="word-spacing:0.0605em;">changes to the valid values that can be in an </span><span class="stl_212 stl_171 stl_28" style="word-spacing:-0.1989em;">ENUM </span><span class="stl_176 stl_32 stl_77" style="word-spacing:0.0623em;">always require a &nbsp;</span></div>
					<div class="stl_01" style="left:11.3993em;top:39.9869em;"><span class="stl_176 stl_32 stl_35" style="word-spacing:0.101em;">schema change. If you do not yet have a robust system that auto‐ &nbsp;</span></div>
					<div class="stl_01" style="left:11.3994em;top:40.9469em;"><span class="stl_176 stl_32 stl_71" style="word-spacing:0.2307em;">mates schema changes as we describe later in this chapter, this &nbsp;</span></div>
					<div class="stl_01" style="left:11.3994em;top:41.9521em;"><span class="stl_176 stl_32 stl_83" style="word-spacing:0.355em;">operational need can be &nbsp;</span></div>
					<div class="stl_01" style="left:20.3255em;top:41.9521em;"><span class="stl_176 stl_32 stl_33" style="word-spacing:0.3569em;">a major inconvenience if your </span><span class="stl_212 stl_171 stl_28">ENUM &nbsp;</span></div>
					<div class="stl_01" style="left:11.3994em;top:42.9573em;z-index:1587;"><span class="stl_176 stl_32 stl_28" style="word-spacing:0.0577em;">changes often. </span><span class="stl_176 stl_32 stl_52">W</span><span class="stl_176 stl_32 stl_28" style="word-spacing:0.0577em;">e </span><span class="stl_176 stl_32 stl_28">a</span><span class="stl_176 stl_32 stl_51" style="word-spacing:0.0655em;">lso refer to an antipattern of “too many </span><span class="stl_212 stl_171 stl_28">ENUM</span><span class="stl_176 stl_32 stl_228">s” &nbsp;</span></div>
					<div class="stl_01" style="left:11.3994em;top:43.9173em;z-index:1647;"><span class="stl_176 stl_32 stl_139" style="word-spacing:0.0102em;">in schema design later. &nbsp;</span></div>
					<div class="stl_01" style="left:6.095em;top:48.2703em;"><span class="stl_167 stl_32 stl_28">3</span></div>
					<div class="stl_01" style="left:6.6667em;top:48.1878em;"><span class="stl_168 stl_32 stl_123" style="word-spacing:0.0051em;">Times are for relative comparison, as the speed of CPUs, memory, and other hardware changes over time. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">134 &nbsp;</span></div>
					<div class="stl_01" style="left:7.6682em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:8.5757em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">Chapter 6: Schema Design and Management &nbsp;</span></div>
					<a name="156_0" style="position:absolute;left:0em;top:15.4994em;">&nbsp;</a>
					<a name="156_1" style="position:absolute;left:0em;top:48.2792em;">&nbsp;</a>
					<a name="156_2" style="position:absolute;left:0em;top:44.1269em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>
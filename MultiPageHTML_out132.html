<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_137.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_137.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:6em;top:4.1653em;"><span class="stl_180 stl_27 stl_28" style="word-spacing:0em;">The InnoDB </span><span class="stl_236 stl_27 stl_28" style="word-spacing:-0.092em;">Buﬀer </span><span class="stl_180 stl_27 stl_28">Pool &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:6.065em;z-index:76;"><span class="stl_154 stl_32 stl_88" style="word-spacing:0.0471em;">The InnoDB buffer pool needs more memory than anything else, as it</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0461em;">s </span><span class="stl_154 stl_32 stl_28">g</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0461em;">enerally the &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:7.115em;"><span class="stl_154 stl_32 stl_123" style="word-spacing:0.0467em;">most important variable for performance. The InnoDB buffer pool doesn’t just cache &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:8.165em;"><span class="stl_154 stl_32 stl_39" style="word-spacing:0.044em;">indexes: it also holds row data, the adaptive hash index, the change buffer, locks, and &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:9.215em;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0047em;">other internal structures. InnoDB also uses the buffer pool to help it delay writes, so it &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:10.265em;"><span class="stl_154 stl_32 stl_33" style="word-spacing:0.1463em;">can merge many writes together and perform them sequentially. In short, InnoDB &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:11.3037em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0573em;">relies </span><span class="stl_155 stl_41 stl_101" style="word-spacing:0.0697em;">heavily </span><span class="stl_154 stl_32 stl_37" style="word-spacing:0.0569em;">on the buffer pool, and you should be sure to allocate enough memory &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:12.4031em;z-index:450;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.031em;">to it. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.031em;">u can use variables from </span><span class="stl_170 stl_171 stl_28">SHO</span><span class="stl_170 stl_171 stl_359">W</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.031em;">commands or tools such as </span><span class="stl_155 stl_41 stl_360" style="word-spacing:0.0517em;">innotop </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">to monitor &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:13.4645em;z-index:533;"><span class="stl_154 stl_32 stl_97" style="word-spacing:0.0031em;">your InnoDB buffer pool</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">s </span><span class="stl_154 stl_32 stl_28">m</span><span class="stl_154 stl_32 stl_361" style="word-spacing:-0.0064em;">emory usage. &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:15.0145em;"><span class="stl_154 stl_32 stl_56" style="word-spacing:0.134em;">If you don’t have much data and you know that your data won’t grow quickly, you &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:16.0645em;"><span class="stl_154 stl_32 stl_107" style="word-spacing:0.0182em;">don’t need to overallocate memory to the buffer pool. It’s not really beneficial to make &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:17.1145em;z-index:749;"><span class="stl_154 stl_32 stl_54" style="word-spacing:0.0256em;">it much larger than the size of the tables and indexes that it will hold. There</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0217em;">s </span><span class="stl_154 stl_32 stl_28">n</span><span class="stl_154 stl_32 stl_28">othing &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:18.1645em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0435em;">wrong with planning ahead for a rapidly growing database, of course, but sometimes &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:19.2145em;z-index:887;"><span class="stl_154 stl_32 stl_139" style="word-spacing:0.0102em;">we see huge buffer pools with a tiny amount of data. This isn’t necessary. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:20.7645em;"><span class="stl_154 stl_32 stl_140" style="word-spacing:0.0517em;">Large buffer pools come with some challenges, such as long shutdown and warm-up &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:21.8145em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0397em;">times. If there are a lot of dirty (modified) pages in the buffer pool, InnoDB can take &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:22.8645em;"><span class="stl_154 stl_32 stl_35" style="word-spacing:0.0491em;">a long time to shut down because it writes the dirty pages to the datafiles upon shut‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:23.9145em;z-index:1102;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0287em;">down. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_35" style="word-spacing:0.0316em;">u can force it to shut down quickly, but then it just has to do more recovery &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:24.9645em;"><span class="stl_154 stl_32 stl_38" style="word-spacing:0.0248em;">when it restarts, so you can’t actually speed up the shutdown and restart cycle time. If &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:26.0145em;"><span class="stl_154 stl_32 stl_88" style="word-spacing:0.4519em;">you know in advance when you need to shut down, you can change the &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:27.1139em;"><span class="stl_170 stl_171 stl_28">innodb_max_dirty_pages_pc</span><span class="stl_170 stl_171 stl_362">t</span><span class="stl_154 stl_32 stl_57" style="word-spacing:0.0335em;">variable at runtime to a lower value, wait for the flush &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:28.1639em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.1486em;">thread to clean up the buffer pool, and then shut down once the number of dirty &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:29.2139em;z-index:1445;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1305em;">pages becomes small. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_57" style="word-spacing:0.1328em;">u can monitor the number of dirty pages by watching the &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:30.302em;"><span class="stl_170 stl_171 stl_28">innodb_buffer_pool_pages_dirt</span><span class="stl_170 stl_171 stl_302">y</span><span class="stl_154 stl_32 stl_189" style="word-spacing:0.0114em;">server status variable or using </span><span class="stl_155 stl_41 stl_360" style="word-spacing:0.0337em;">innotop </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">to monitor &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:31.4128em;z-index:1582;"><span class="stl_170 stl_171 stl_28" style="word-spacing:0.0473em;">SHOW INNODB STATUS</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0473em;">. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0473em;">u can also use the variable </span><span class="stl_170 stl_171 stl_28">innodb_fast_shutdow</span><span class="stl_170 stl_171 stl_363">n</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0473em;">to tweak &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:32.4628em;"><span class="stl_154 stl_32 stl_46" style="word-spacing:0.0025em;">how shutdown occurs. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:34.0622em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.2257em;">Lowering the value of the </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.0235em;">innodb_max_dirty_pages_pct </span><span class="stl_154 stl_32 stl_81" style="word-spacing:0.2373em;">variable doesn’t actually &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:35.1122em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0399em;">guarantee that InnoDB will keep fewer dirty pages in the buffer pool. Instead, it con‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:36.1622em;z-index:1846;"><span class="stl_154 stl_32 stl_114" style="word-spacing:0.0821em;">trols the threshold at which InnoDB stops being “lazy</span><span class="stl_154 stl_32 stl_161">.</span><span class="stl_154 stl_32 stl_151" style="word-spacing:0.0871em;">” InnoDB</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0771em;">s </span><span class="stl_154 stl_32 stl_28">d</span><span class="stl_154 stl_32 stl_143" style="word-spacing:0.0828em;">efault behavior is &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:37.2122em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0345em;">to flush dirty pages with a background thread, merging writes together and perform‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:38.2622em;"><span class="stl_154 stl_32 stl_72" style="word-spacing:0.224em;">ing them sequentially for efficiency. This behavior is called “lazy” because it lets &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:39.3122em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.0587em;">InnoDB delay flushing dirty pages in the buffer pool unless it needs to use the space &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:40.3622em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.2332em;">for some other data. When the percentage of dirty pages exceeds the threshold, &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:41.4122em;z-index:2212;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.0338em;">InnoDB will flush pages as quickly as it can to try to keep the dirty page count lower. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:42.4622em;z-index:2283;"><span class="stl_154 stl_32 stl_77" style="word-spacing:0.1059em;">These page cleaner operations have been greatly </span><a href="https://oreil.ly/S8ong" target="_blank"><span class="stl_184 stl_32 stl_28" style="word-spacing:0.1026em;">optimized </span></a><span class="stl_154 stl_32 stl_107" style="word-spacing:0.1116em;">from previous behavior, &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:43.5122em;"><span class="stl_154 stl_32 stl_140" style="word-spacing:0.0007em;">including being able to configure multiple threads to perform flushing. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:45.0622em;"><span class="stl_154 stl_32 stl_84" style="word-spacing:0.0332em;">When MySQL starts back up again, the buffer pool cache is empty, also referred to as &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:46.1009em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0799em;">a </span><span class="stl_155 stl_41 stl_194" style="word-spacing:0.0934em;">cold cache</span><span class="stl_154 stl_32 stl_126" style="word-spacing:0.0793em;">. All of the benefits of having rows and pages in memory are now gone. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:47.2117em;"><span class="stl_154 stl_32 stl_47" style="word-spacing:0.0254em;">Thankfully, by default the configuration options </span><span class="stl_170 stl_171 stl_28">innodb_buffer_pool_dump_at_shut &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">110 &nbsp;</span></div>
					<div class="stl_01" style="left:7.6679em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:8.5754em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">Chapter 5: Optimizing Server Settings &nbsp;</span></div>
					<a name="132_0" style="position:absolute;left:0em;top:4.4583em;">&nbsp;</a>
					<a name="132_1" style="position:absolute;left:0em;top:6.2943em;">&nbsp;</a>
					<a name="132_2" style="position:absolute;left:0em;top:46.3415em;">&nbsp;</a>
					<a name="132_3" style="position:absolute;left:0em;top:23.0937em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>
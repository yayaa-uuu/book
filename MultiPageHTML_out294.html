<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_319.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_319.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:6em;top:4.3052em;"><span class="stl_155 stl_41 stl_240" style="word-spacing:0.0203em;">Huge SQL statements &nbsp;</span></div>
					<div class="stl_01" style="left:7.4998em;top:5.3666em;"><span class="stl_154 stl_32 stl_124" style="word-spacing:0.124em;">It’s a lot of work for the server to parse and execute all of the SQL statements. &nbsp;</span></div>
					<div class="stl_01" style="left:7.5001em;top:6.4166em;"><span class="stl_154 stl_32 stl_140" style="word-spacing:0.0008em;">This is a very slow way to load data. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:8.0385em;"><span class="stl_155 stl_41 stl_356" style="word-spacing:0.0168em;">A single huge </span><span class="stl_216 stl_41 stl_28">ﬁle &nbsp;</span></div>
					<div class="stl_01" style="left:7.5001em;top:9.0999em;"><span class="stl_154 stl_32 stl_33" style="word-spacing:0.0707em;">Most text editors can’t edit large files or files with very long lines. Although you &nbsp;</span></div>
					<div class="stl_01" style="left:7.4996em;top:10.1386em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0434em;">can sometimes use command-line stream editors, such as </span><span class="stl_155 stl_41 stl_97" style="word-spacing:0.0444em;">sed </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0434em;">or </span><span class="stl_155 stl_41 stl_301" style="word-spacing:0.0694em;">grep, </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0434em;">to pull out &nbsp;</span></div>
					<div class="stl_01" style="left:7.5em;top:11.1999em;z-index:285;"><span class="stl_154 stl_32 stl_124" style="word-spacing:0.0071em;">the data you need, it</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">s </span><span class="stl_154 stl_32 stl_28">p</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">referable to keep the files small. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:12.8219em;"><span class="stl_155 stl_41 stl_215" style="word-spacing:0.0125em;">Logical backups are expensive &nbsp;</span></div>
					<div class="stl_01" style="left:7.5em;top:13.8833em;"><span class="stl_154 stl_32 stl_48" style="word-spacing:0.0311em;">There are more efficient ways to get data out of MySQL than fetching it from the &nbsp;</span></div>
					<div class="stl_01" style="left:7.5004em;top:14.9333em;"><span class="stl_154 stl_32 stl_37" style="word-spacing:-0.0004em;">storage engine and sending it over the client/server protocol as a result set. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:16.4833em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.0563em;">As you can see, logical backups can be difficult to make work for your environment. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:17.5333em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.3239em;">If you need to use logical backups, we strongly recommend that you look at &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:18.5719em;"><span class="stl_155 stl_41 stl_393" style="word-spacing:0.0619em;">mydumper </span><span class="stl_154 stl_32 stl_57" style="word-spacing:0.0448em;">to avoid the single-threaded nature and spend time measuring the impact &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:19.6333em;"><span class="stl_154 stl_32 stl_39" style="word-spacing:0.0034em;">on your database as you perform the backup. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:21.5176em;"><span class="stl_180 stl_27 stl_28" style="word-spacing:0em;">Filesystem Snapshots &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:23.4173em;"><span class="stl_154 stl_32 stl_77" style="word-spacing:0.0682em;">Filesystem snapshots are a great way to make online backups. Snapshot-capable file‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:24.4673em;"><span class="stl_154 stl_32 stl_33" style="word-spacing:0.1073em;">systems can create a consistent image of their contents at an instant in time, which &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:25.5173em;"><span class="stl_154 stl_32 stl_77" style="word-spacing:0.1948em;">you can then use to make a backup. Snapshot-capable filesystems and appliances &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:26.5673em;z-index:989;"><span class="stl_154 stl_32 stl_143" style="word-spacing:0.0495em;">include FreeBSD</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.044em;">s </span><span class="stl_154 stl_32 stl_28">f</span><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0452em;">ilesystem, the ZFS filesystem, GNU/Linux</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_202" style="word-spacing:0.0644em;">s LVM, and many SAN &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:27.6173em;"><span class="stl_154 stl_32 stl_35" style="word-spacing:0.1291em;">systems and file-storage solutions, such as NetApp storage appliances. Some of the &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:28.6673em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.0265em;">remotely attached disk options available in cloud providers offer disk snapshotting as &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:29.7173em;"><span class="stl_154 stl_32 stl_28">well. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:31.2673em;"><span class="stl_154 stl_32 stl_144" style="word-spacing:0.0592em;">Don’t confuse a snapshot with a backup. Taking a snapshot is simply a way of reduc‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:32.3173em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0072em;">ing the time for which locks must be held; after releasing the locks, you must copy the &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:33.3673em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.1481em;">files to the backup. In fact, you can optionally take snapshots on InnoDB without &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:34.4173em;z-index:1384;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0068em;">even acquiring locks. </span><span class="stl_154 stl_32 stl_52">W</span><span class="stl_154 stl_32 stl_219">e</span><span class="stl_154 stl_32 stl_220">’</span><span class="stl_154 stl_32 stl_120" style="word-spacing:0.0131em;">ll show you two ways to use LVM to make backups of an all- &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:35.4673em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">InnoDB system, with your choice of minimal or zero locking. &nbsp;</span></div>
					<div class="stl_01" style="left:11.6991em;top:38.0678em;"><span class="stl_239 stl_27 stl_28" style="word-spacing:0em;">Backup Myth #2: “My Snapshot Is My Backup” &nbsp;</span></div>
					<div class="stl_01" style="left:6.6875em;top:39.8158em;z-index:1535;"><span class="stl_31 stl_32 stl_71" style="word-spacing:0.0275em;">A snapshot, whether it</span><span class="stl_31 stl_32 stl_34">’</span><span class="stl_31 stl_32 stl_28" style="word-spacing:0.0217em;">s </span><span class="stl_31 stl_32 stl_28">a</span><span class="stl_31 stl_32 stl_116" style="word-spacing:0.0347em;">n LVM, ZFS, or SAN snapshot, isn’t a real backup because it &nbsp;</span></div>
					<div class="stl_01" style="left:6.6875em;top:40.8158em;"><span class="stl_31 stl_32 stl_47" style="word-spacing:0.1282em;">doesn’t contain a full copy of your data. Because snapshots are copy-on-write, they &nbsp;</span></div>
					<div class="stl_01" style="left:6.6875em;top:41.8158em;"><span class="stl_31 stl_32 stl_39" style="word-spacing:0.0035em;">contain only the differences between the live copy of the data and the data at the point &nbsp;</span></div>
					<div class="stl_01" style="left:6.6875em;top:42.8158em;"><span class="stl_31 stl_32 stl_78" style="word-spacing:0.0367em;">in time when the snapshot happened. If an unmodified block becomes corrupt in the &nbsp;</span></div>
					<div class="stl_01" style="left:6.6875em;top:43.8158em;z-index:1866;"><span class="stl_31 stl_32 stl_85" style="word-spacing:0.0405em;">live copy of the data, there’s no good copy of that block that you can use for recovery, &nbsp;</span></div>
					<div class="stl_01" style="left:6.6875em;top:44.8158em;"><span class="stl_31 stl_32 stl_83" style="word-spacing:0.1787em;">and every snapshot sees the same corrupted block that the live volume does. Use &nbsp;</span></div>
					<div class="stl_01" style="left:6.6875em;top:45.8158em;"><span class="stl_31 stl_32 stl_25" style="word-spacing:0.0964em;">snapshots to “freeze” your data while you take a backup, but don’t rely on the snap‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6.6875em;top:46.8158em;"><span class="stl_31 stl_32 stl_36" style="word-spacing:0.0039em;">shot itself as a backup. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">272 &nbsp;</span></div>
					<div class="stl_01" style="left:7.6679em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:8.5754em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">Chapter 10: Backup and Recovery &nbsp;</span></div>
					<a name="294_0" style="position:absolute;left:0em;top:21.8106em;">&nbsp;</a>
					<a name="294_1" style="position:absolute;left:0em;top:23.6466em;">&nbsp;</a>
					<a name="294_2" style="position:absolute;left:0em;top:19.8625em;">&nbsp;</a>
					<a name="294_3" style="position:absolute;left:0em;top:31.4966em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>
<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_240.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_240.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:7.7708em;top:4.5292em;"><span class="stl_200 stl_171 stl_28"># Do something with result &nbsp;</span></div>
					<div class="stl_01" style="left:7.4167em;top:5.3792em;"><span class="stl_200 stl_171 stl_28">}</span></div>
					<div class="stl_01" style="left:5.9998em;top:6.566em;"><span class="stl_154 stl_32 stl_120" style="word-spacing:0.0287em;">Notice that the call to </span><span class="stl_170 stl_171 stl_28">prepare(</span><span class="stl_170 stl_171 stl_309">)</span><span class="stl_154 stl_32 stl_71" style="word-spacing:0.0282em;">specified to “use” the result instead of “buffering” it. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:7.616em;z-index:102;"><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_37" style="word-spacing:0.3606em;">u can also specify this when connecting, which will make every statement &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:8.666em;"><span class="stl_154 stl_32 stl_28">unbuffered: &nbsp;</span></div>
					<div class="stl_01" style="left:7.4169em;top:10.4279em;"><span class="stl_200 stl_171 stl_28" style="word-spacing:0em;">my $dbh = DBI-&gt;connect('DBI:mysql:;</span><span class="stl_265 stl_173 stl_28">mysql_use_result=1</span><span class="stl_200 stl_171 stl_28">', 'user', 'p4ssword'); &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:11.9003em;"><span class="stl_180 stl_27 stl_28" style="word-spacing:0em;">Query States &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:13.7887em;"><span class="stl_154 stl_32 stl_48" style="word-spacing:0.1521em;">Each MySQL connection, or </span><span class="stl_155 stl_41 stl_243">thread</span><span class="stl_154 stl_32 stl_162" style="word-spacing:0.1564em;">, has a state that shows what it is doing at any &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:14.8501em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.113em;">given time. There are several ways to view these states, but the easiest is to use the &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:15.9496em;"><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.0104em;">SHOW FULL PROCESSLIST </span><span class="stl_154 stl_32 stl_39" style="word-spacing:0.0787em;">command (the states appear in the </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1818em;">Command </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0753em;">column). As a &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:16.9995em;"><span class="stl_154 stl_32 stl_87" style="word-spacing:0.1344em;">query progresses through its life cycle, its state changes many times, and there are &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:18.0496em;"><span class="stl_154 stl_32 stl_72" style="word-spacing:0.0209em;">dozens of states. The MySQL manual is the authoritative source of information for all &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:19.0995em;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.0021em;">the states, but we list a few here and explain what they mean: &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:20.7215em;"><span class="stl_155 stl_41 stl_151">Sleep &nbsp;</span></div>
					<div class="stl_01" style="left:7.5004em;top:21.7829em;"><span class="stl_154 stl_32 stl_126" style="word-spacing:-0.0006em;">The thread is waiting for a new query from the client. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:23.4048em;"><span class="stl_155 stl_41 stl_313">Query &nbsp;</span></div>
					<div class="stl_01" style="left:7.5004em;top:24.4662em;"><span class="stl_154 stl_32 stl_37" style="word-spacing:-0.0004em;">The thread is either executing the query or sending the result back to the client. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:26.0882em;"><span class="stl_155 stl_41 stl_100">Locked &nbsp;</span></div>
					<div class="stl_01" style="left:7.5004em;top:27.1496em;"><span class="stl_154 stl_32 stl_88" style="word-spacing:0.0462em;">The thread is waiting for a table lock to be granted at the server level. Locks that &nbsp;</span></div>
					<div class="stl_01" style="left:7.4999em;top:28.1996em;z-index:892;"><span class="stl_154 stl_32 stl_48" style="word-spacing:0.0236em;">are implemented by the storage engine, such as InnoDB</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0199em;">s </span><span class="stl_154 stl_32 stl_28">r</span><span class="stl_154 stl_32 stl_97" style="word-spacing:0.0228em;">ow locks, do not cause &nbsp;</span></div>
					<div class="stl_01" style="left:7.5003em;top:29.299em;"><span class="stl_154 stl_32 stl_35" style="word-spacing:0.0027em;">the thread to enter the </span><span class="stl_170 stl_171 stl_28">Locke</span><span class="stl_170 stl_171 stl_186">d</span><span class="stl_154 stl_32 stl_55">state. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:30.921em;"><span class="stl_155 stl_41 stl_93" style="word-spacing:0.016em;">Analyzing and statistics &nbsp;</span></div>
					<div class="stl_01" style="left:7.5003em;top:31.9823em;z-index:1028;"><span class="stl_154 stl_32 stl_83" style="word-spacing:0.0024em;">The thread is checking storage engine statistics and optimizing the query. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:33.6043em;"><span class="stl_155 stl_41 stl_257" style="word-spacing:0.0153em;">Copying to tmp table [on disk] &nbsp;</span></div>
					<div class="stl_01" style="left:7.5003em;top:34.6657em;"><span class="stl_154 stl_32 stl_227" style="word-spacing:0.1816em;">The thread is processing the query and copying results to a temporary table, &nbsp;</span></div>
					<div class="stl_01" style="left:7.4998em;top:35.7651em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0275em;">probably for a </span><span class="stl_170 stl_171 stl_444" style="word-spacing:-0.0091em;">GROUP BY</span><span class="stl_154 stl_32 stl_122" style="word-spacing:0.0277em;">, for a filesort, or to satisfy a </span><span class="stl_170 stl_171 stl_28">UNION</span><span class="stl_154 stl_32 stl_97" style="word-spacing:0.0304em;">. If the state ends with &nbsp;</span></div>
					<div class="stl_01" style="left:7.5001em;top:36.8151em;z-index:1194;"><span class="stl_154 stl_32 stl_445" style="word-spacing:0.0277em;">“on disk</span><span class="stl_154 stl_32 stl_161">,</span><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0013em;">” MySQL is converting an in-memory table to an on-disk table. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:38.4371em;"><span class="stl_155 stl_41 stl_42" style="word-spacing:0.0138em;">Sorting result &nbsp;</span></div>
					<div class="stl_01" style="left:7.5001em;top:39.4984em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">The thread is sorting a result set. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:41.0484em;"><span class="stl_154 stl_32 stl_148" style="word-spacing:0.1173em;">It’s helpful to at least know the basic states, so you can get a sense of “who has the &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:42.0984em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.0137em;">ball” for the query. On very busy servers, you might see a normally brief state, such as &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:43.1979em;"><span class="stl_170 stl_171 stl_28">statistics</span><span class="stl_154 stl_32 stl_77" style="word-spacing:0.1327em;">, begin to take a significant amount of time. This usually indicates that &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:44.2479em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">something is wrong. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">204 &nbsp;</span></div>
					<div class="stl_01" style="left:7.6679em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:8.5754em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">Chapter 8: Query Performance Optimization &nbsp;</span></div>
					<a name="226_0" style="position:absolute;left:0em;top:12.1934em;">&nbsp;</a>
					<a name="226_1" style="position:absolute;left:0em;top:7.8453em;">&nbsp;</a>
					<a name="226_2" style="position:absolute;left:0em;top:14.0294em;">&nbsp;</a>
					<a name="226_3" style="position:absolute;left:0em;top:15.0794em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>
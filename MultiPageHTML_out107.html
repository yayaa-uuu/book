<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_113.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_113.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:6em;top:4.3166em;z-index:30;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.0606em;">In general, the RAID controller</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0589em;">s </span><span class="stl_154 stl_32 stl_28">m</span><span class="stl_154 stl_32 stl_178" style="word-spacing:0.0563em;">emory is a scarce resource that you should try to &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:5.3666em;"><span class="stl_154 stl_32 stl_47" style="word-spacing:0.0387em;">use wisely. Using it for reads is usually a waste, but using it for writes is an important &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:6.4166em;"><span class="stl_154 stl_32 stl_97" style="word-spacing:0.0398em;">way to speed up your I/O performance. Many controllers let you choose how to allo‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:7.4666em;"><span class="stl_154 stl_32 stl_123" style="word-spacing:0.139em;">cate the memory. For example, you can choose how much of it to use for caching &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:8.5166em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.0016em;">writes and how much for reads. For RAID 0, RAID 1, and RAID 10, you should prob‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:9.5666em;z-index:372;"><span class="stl_154 stl_32 stl_97" style="word-spacing:0.1253em;">ably allocate 100% of the controller</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1224em;">s </span><span class="stl_154 stl_32 stl_28">m</span><span class="stl_154 stl_32 stl_125" style="word-spacing:0.1216em;">emory for caching writes. For RAID 5, you &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:10.6166em;z-index:441;"><span class="stl_154 stl_32 stl_125" style="word-spacing:0.1448em;">should reserve some of the controller</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1456em;">s </span><span class="stl_154 stl_32 stl_28">m</span><span class="stl_154 stl_32 stl_158" style="word-spacing:0.1462em;">emory for its internal operations. This is &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:11.6666em;"><span class="stl_154 stl_32 stl_143" style="word-spacing:0.0619em;">generally good advice, but it doesn’t always apply—different RAID cards require dif‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:12.7166em;"><span class="stl_154 stl_32 stl_54" style="word-spacing:0.004em;">ferent configurations. &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:14.2666em;"><span class="stl_154 stl_32 stl_72" style="word-spacing:0.074em;">When you’re using the RAID cache for write caching, many controllers let you con‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:15.3166em;z-index:657;"><span class="stl_154 stl_32 stl_84" style="word-spacing:0.1014em;">figure how long it</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0969em;">s </span><span class="stl_154 stl_32 stl_28">a</span><span class="stl_154 stl_32 stl_140" style="word-spacing:0.0978em;">cceptable to delay the writes (one second, five seconds, and so &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:16.3666em;"><span class="stl_154 stl_32 stl_140" style="word-spacing:0.1017em;">on). A longer delay means more writes can be grouped together and flushed to the &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:17.4166em;z-index:844;"><span class="stl_154 stl_32 stl_222" style="word-spacing:0.0892em;">disks optimally. The downside is that your writes will be more “bursty</span><span class="stl_154 stl_32 stl_161">.</span><span class="stl_154 stl_32 stl_22" style="word-spacing:0.1053em;">” That</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0823em;">s </span><span class="stl_154 stl_32 stl_28">n</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0823em;">ot a &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:18.4666em;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.0532em;">bad thing, unless your application happens to make a bunch of write requests just as &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:19.5166em;z-index:986;"><span class="stl_154 stl_32 stl_77" style="word-spacing:0.192em;">the controller</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1888em;">s </span><span class="stl_154 stl_32 stl_28">c</span><span class="stl_154 stl_32 stl_162" style="word-spacing:0.1968em;">ache fills up, when it</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1888em;">s </span><span class="stl_154 stl_32 stl_28">a</span><span class="stl_154 stl_32 stl_123" style="word-spacing:0.1941em;">bout to be flushed to disk. If there</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1889em;">s </span><span class="stl_154 stl_32 stl_28">n</span><span class="stl_154 stl_32 stl_28">ot &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:20.5666em;"><span class="stl_154 stl_32 stl_183" style="word-spacing:0.0148em;">enough room for your application’s write requests, it’ll have to wait. Keeping the delay &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:21.6166em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.129em;">shorter means you’ll have more write operations and they’ll be less efficient, but it &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:22.6666em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1446em;">smooths out the spikiness and helps keep more of the cache free to handle bursts &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:23.7166em;z-index:1223;"><span class="stl_154 stl_32 stl_72" style="word-spacing:0.3642em;">from the application. (</span><span class="stl_154 stl_32 stl_52">W</span><span class="stl_154 stl_32 stl_162" style="word-spacing:0.3678em;">e’re simplifying here—controllers often have complex, &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:24.7666em;"><span class="stl_154 stl_32 stl_36" style="word-spacing:0.4353em;">vendor-specific balancing algorithms, so we’re just trying to cover the basic &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:25.8166em;"><span class="stl_154 stl_32 stl_28">principles.) &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:27.416em;"><span class="stl_154 stl_32 stl_102" style="word-spacing:0.0552em;">The write cache is very helpful for synchronous writes, such as issuing </span><span class="stl_170 stl_171 stl_28">fsync(</span><span class="stl_170 stl_171 stl_328">)</span><span class="stl_154 stl_32 stl_28">calls &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:28.5155em;"><span class="stl_154 stl_32 stl_126" style="word-spacing:0.0784em;">on the transaction logs and creating binary logs with </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1779em;">sync_binlog </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.079em;">enabled, but you &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:29.5655em;"><span class="stl_154 stl_32 stl_114" style="word-spacing:0.1117em;">shouldn’t enable it unless your controller has a battery backup unit (BBU) or other &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:30.6155em;"><span class="stl_154 stl_32 stl_46" style="word-spacing:0.0497em;">nonvolatile storage. Caching writes without a BBU is likely to corrupt your database, &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:31.6655em;z-index:1706;"><span class="stl_154 stl_32 stl_84" style="word-spacing:0.0362em;">and even your transactional filesystem, in the event of power loss. If you have a BBU, &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:32.7155em;"><span class="stl_154 stl_32 stl_57" style="word-spacing:0.0142em;">however, enabling the write cache can increase performance by a factor of 20 or more &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:33.7655em;"><span class="stl_154 stl_32 stl_140" style="word-spacing:0.0382em;">for workloads that do a lot of log flushes, such as flushing the transaction log when a &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:34.8155em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">transaction commits. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:36.3655em;"><span class="stl_154 stl_32 stl_35" style="word-spacing:0.0571em;">A final consideration is that many hard drives have write caches of their own, which &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:37.4649em;"><span class="stl_154 stl_32 stl_327" style="word-spacing:0.0326em;">can “fake” </span><span class="stl_170 stl_171 stl_28">fsync(</span><span class="stl_170 stl_171 stl_306">)</span><span class="stl_154 stl_32 stl_39" style="word-spacing:0.0105em;">operations by lying to the controller that the data has been written &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:38.5149em;"><span class="stl_154 stl_32 stl_77" style="word-spacing:0.2959em;">to physical media. Hard drives that are attached directly (as opposed to being &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:39.5649em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.1537em;">attached to a RAID controller) can sometimes let their caches be managed by the &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:40.6149em;"><span class="stl_154 stl_32 stl_138" style="word-spacing:0.2436em;">operating system, but this doesn’t always work either. These caches are typically &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:41.7143em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0698em;">flushed for an </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1876em;">fsync() </span><span class="stl_154 stl_32 stl_73" style="word-spacing:0.0718em;">and bypassed for synchronous I/O, but again, the hard drive &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:42.8138em;z-index:2289;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0574em;">can lie. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_88" style="word-spacing:0.0585em;">u should either ensure that these caches are flushed on </span><span class="stl_170 stl_171 stl_28">fsync(</span><span class="stl_170 stl_171 stl_326">)</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0574em;">or disable &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:43.8638em;"><span class="stl_154 stl_32 stl_143" style="word-spacing:0.0693em;">them because they are not battery-backed. Hard drives that aren’t managed properly &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:44.9138em;"><span class="stl_154 stl_32 stl_72" style="word-spacing:0.0045em;">by the operating system or RAID firmware have caused many instances of data loss. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:46.4638em;z-index:2517;"><span class="stl_154 stl_32 stl_84" style="word-spacing:0.0104em;">For this and other reasons, it</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0058em;">s </span><span class="stl_154 stl_32 stl_28">a</span><span class="stl_154 stl_32 stl_73" style="word-spacing:0.0078em;">lways a good idea to do genuine crash testing (literally &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:47.5138em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0524em;">pulling the power plug out of the wall) when you install new hardware. This is often &nbsp;</span></div>
					<div class="stl_01" style="left:25.9022em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">RAID Performance Optimization &nbsp;</span></div>
					<div class="stl_01" style="left:34.4807em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:35.3882em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">85 &nbsp;</span></div>
				</div>
			</div>
		</div>
	</body>
</html>
<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_296.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_296.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:6em;top:4.3166em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0417em;">When setting up replication monitoring, there are a few items that we consider most &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:5.3666em;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0011em;">important to observe: &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:6.9885em;"><span class="stl_155 stl_41 stl_121" style="word-spacing:0.019em;">Replication requires disk space on both source and replica &nbsp;</span></div>
					<div class="stl_01" style="left:7.5004em;top:8.0499em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0376em;">As seen earlier in </span><a href="MultiPageHTML_out252.html#252_2"><span class="stl_184 stl_32 stl_28" style="word-spacing:0.0376em;">Figure 9-1</span></a><span class="stl_154 stl_32 stl_126" style="word-spacing:0.037em;">, replication uses both binary logs on the source and &nbsp;</span></div>
					<div class="stl_01" style="left:7.4999em;top:9.0999em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.0149em;">relay logs on the replicas. If there is no free disk space on the source, transactions &nbsp;</span></div>
					<div class="stl_01" style="left:7.5003em;top:10.1499em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0507em;">will be unable to complete and will begin timing out. If the same condition hap‐ &nbsp;</span></div>
					<div class="stl_01" style="left:7.4998em;top:11.1999em;"><span class="stl_154 stl_32 stl_77" style="word-spacing:0.0567em;">pens on a replica, MySQL behaves a little more gracefully by pausing replication &nbsp;</span></div>
					<div class="stl_01" style="left:7.5001em;top:12.2499em;z-index:442;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1407em;">and waiting for free disk space. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_77" style="word-spacing:0.1438em;">u’ll want to monitor both for available disk &nbsp;</span></div>
					<div class="stl_01" style="left:7.4996em;top:13.2999em;"><span class="stl_154 stl_32 stl_33" style="word-spacing:0.0042em;">space to ensure continued operation. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:14.9219em;"><span class="stl_155 stl_41 stl_49" style="word-spacing:0.0185em;">Replication should be monitored for state and for errors &nbsp;</span></div>
					<div class="stl_01" style="left:7.4996em;top:15.9833em;"><span class="stl_154 stl_32 stl_87" style="word-spacing:0.0734em;">Although replication has been a long-standing feature and is very robust, exter‐ &nbsp;</span></div>
					<div class="stl_01" style="left:7.5em;top:17.0333em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.2079em;">nal factors like network issues, data inconsistencies, and data corruption can &nbsp;</span></div>
					<div class="stl_01" style="left:7.5004em;top:18.0833em;z-index:729;"><span class="stl_154 stl_32 stl_36" style="word-spacing:0.1594em;">cause it to break. Because of this, it</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1556em;">s </span><span class="stl_154 stl_32 stl_28">i</span><span class="stl_154 stl_32 stl_78" style="word-spacing:0.157em;">deal to monitor for whether replication &nbsp;</span></div>
					<div class="stl_01" style="left:7.4999em;top:19.1333em;"><span class="stl_154 stl_32 stl_57" style="word-spacing:0.1429em;">threads are running and if not, look into what the latest error is to determine &nbsp;</span></div>
					<div class="stl_01" style="left:7.5003em;top:20.1833em;z-index:856;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.1018em;">what your next step should be. </span><span class="stl_154 stl_32 stl_52">W</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0998em;">e </span><span class="stl_154 stl_32 stl_28">c</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0998em;">over more about how to troubleshoot spe‐ &nbsp;</span></div>
					<div class="stl_01" style="left:7.4998em;top:21.2333em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">cific problems in </span><a href="MultiPageHTML_out273.html#273_0"><span class="stl_184 stl_32 stl_39" style="word-spacing:0.0033em;">“Replication Problems and Solutions” on page 251</span></a><span class="stl_154 stl_32 stl_39" style="word-spacing:0.0033em;">. &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:22.8552em;"><span class="stl_155 stl_41 stl_98" style="word-spacing:0.015em;">Delayed replication should be delayed as expected &nbsp;</span></div>
					<div class="stl_01" style="left:7.4998em;top:23.9166em;z-index:1038;"><span class="stl_154 stl_32 stl_55" style="word-spacing:0.016em;">Since we mentioned delayed replication earlier, it</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0083em;">s </span><span class="stl_154 stl_32 stl_28">a</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0083em;">dvisable to set up monitoring &nbsp;</span></div>
					<div class="stl_01" style="left:7.5001em;top:24.9666em;"><span class="stl_154 stl_32 stl_35" style="word-spacing:0.0489em;">to ensure that delayed replicas are in fact delayed by the correct amount of time. &nbsp;</span></div>
					<div class="stl_01" style="left:7.4997em;top:26.0166em;"><span class="stl_154 stl_32 stl_105">T</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_39" style="word-spacing:0.0097em;">o long of a delay might make it much more time consuming to use. If the delay &nbsp;</span></div>
					<div class="stl_01" style="left:7.5em;top:27.0666em;"><span class="stl_154 stl_32 stl_97" style="word-spacing:0.0108em;">is too little—or even worse, not delayed at all—the delayed copy may be of no use &nbsp;</span></div>
					<div class="stl_01" style="left:7.5004em;top:28.1166em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">to you if you need it. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:30.0009em;"><span class="stl_180 stl_27 stl_28" style="word-spacing:0em;">Measuring Replication Lag &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:31.9007em;"><span class="stl_154 stl_32 stl_87" style="word-spacing:0.0344em;">One of the most common things you’ll need to monitor is how far behind the source &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:33.0001em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0297em;">a replica is running. Although the </span><span class="stl_170 stl_171 stl_28">Seconds_behind_sourc</span><span class="stl_170 stl_171 stl_365">e</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0297em;">column in </span><span class="stl_170 stl_171 stl_28" style="word-spacing:0em;">SHOW REPLICA &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:34.0996em;z-index:1486;"><span class="stl_170 stl_171 stl_28">STATU</span><span class="stl_170 stl_171 stl_476">S</span><span class="stl_154 stl_32 stl_99" style="word-spacing:0.0542em;">theoretically shows the replica</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0479em;">s </span><span class="stl_154 stl_32 stl_28">l</span><span class="stl_154 stl_32 stl_222" style="word-spacing:0.0547em;">ag, in fact it</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0479em;">s </span><span class="stl_154 stl_32 stl_28">n</span><span class="stl_154 stl_32 stl_36" style="word-spacing:0.0516em;">ot always accurate, for a vari‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:35.1496em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">ety of reasons: &nbsp;</span></div>
					<div class="stl_01" style="left:6.7217em;top:37.0823em;z-index:1590;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.2723em;">• The</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0227em;">&nbsp;</span><span class="stl_154 stl_32 stl_46" style="word-spacing:0.0252em;">replica calculates </span><span class="stl_170 stl_171 stl_28">Seconds_behind_sourc</span><span class="stl_170 stl_171 stl_309">e</span><span class="stl_154 stl_32 stl_102" style="word-spacing:0.0215em;">by comparing the server</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0227em;">s </span><span class="stl_154 stl_32 stl_28">c</span><span class="stl_154 stl_32 stl_55">urrent &nbsp;</span></div>
					<div class="stl_01" style="left:7.5004em;top:38.1323em;"><span class="stl_154 stl_32 stl_24" style="word-spacing:0.0428em;">timestamp to the timestamp recorded in the binary log event, so the replica can’t &nbsp;</span></div>
					<div class="stl_01" style="left:7.4999em;top:39.1823em;z-index:1708;"><span class="stl_154 stl_32 stl_46" style="word-spacing:0.0027em;">even report its lag unless it is processing a query. &nbsp;</span></div>
					<div class="stl_01" style="left:6.7214em;top:40.6151em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.2725em;">• The</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">&nbsp;</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">replica will usually report </span><span class="stl_170 stl_171 stl_28">NUL</span><span class="stl_170 stl_171 stl_186">L</span><span class="stl_154 stl_32 stl_20" style="word-spacing:0.0087em;">if the replication threads aren’t running. &nbsp;</span></div>
					<div class="stl_01" style="left:6.7213em;top:42.0479em;"><span class="stl_154 stl_32 stl_35" style="word-spacing:0.2174em;">• Some errors (for example, mismatched </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.0475em;">max_allowed_packet </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.2029em;">settings between &nbsp;</span></div>
					<div class="stl_01" style="left:7.5001em;top:43.0979em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.0356em;">the source and replica or an unstable network) can break replication and/or stop &nbsp;</span></div>
					<div class="stl_01" style="left:7.4996em;top:44.1973em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.1955em;">the replication threads, but </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.0571em;">Seconds_behind_source </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1937em;">will report </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.0571em;">0 </span><span class="stl_154 stl_32 stl_38" style="word-spacing:0.1985em;">rather than &nbsp;</span></div>
					<div class="stl_01" style="left:7.5em;top:45.2473em;z-index:1996;"><span class="stl_154 stl_32 stl_25" style="word-spacing:0.0109em;">indicating an error. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">248 &nbsp;</span></div>
					<div class="stl_01" style="left:7.6676em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:8.5751em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">Chapter 9: Replication &nbsp;</span></div>
					<a name="270_0" style="position:absolute;left:0em;top:30.294em;">&nbsp;</a>
					<a name="270_1" style="position:absolute;left:0em;top:32.1299em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>
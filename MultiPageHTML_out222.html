<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_235.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_235.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:6em;top:4.3166em;"><span class="stl_154 stl_32 stl_46" style="word-spacing:0.0234em;">storage engines might benefit from smaller transactions). It might also be a good idea &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:5.416em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0798em;">to add some sleep time between the </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1771em;">DELETE </span><span class="stl_154 stl_32 stl_97" style="word-spacing:0.0827em;">statements to spread the load over time &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:6.466em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0014em;">and reduce the amount of time locks are held. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0006em;top:8.3503em;"><span class="stl_180 stl_27 stl_28" style="word-spacing:0em;">Join Decomposition &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:10.2387em;z-index:250;"><span class="stl_154 stl_32 stl_114" style="word-spacing:0.1416em;">Many high-performance applications use </span><span class="stl_155 stl_41 stl_226" style="word-spacing:0.1519em;">join decomposition</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1365em;">. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_36" style="word-spacing:0.1403em;">u can decompose a &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:11.3001em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.1469em;">join by running multiple single-table queries instead of a multitable join and then &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:12.3501em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.0006em;">performing the join in the application. For example, instead of this single query: &nbsp;</span></div>
					<div class="stl_01" style="left:7.4166em;top:14.112em;"><span class="stl_265 stl_173 stl_28">SELECT * FROM tag &nbsp;</span></div>
					<div class="stl_01" style="left:7.4166em;top:14.962em;"><span class="stl_265 stl_173 stl_28">JOIN tag_post ON tag_post.tag_id=tag.id &nbsp;</span></div>
					<div class="stl_01" style="left:7.4166em;top:15.812em;"><span class="stl_265 stl_173 stl_28" style="word-spacing:0em;">JOIN post ON tag_post.post_id=post.id &nbsp;</span></div>
					<div class="stl_01" style="left:7.4166em;top:16.662em;"><span class="stl_265 stl_173 stl_28">WHERE tag.tag='mysql'; &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:17.8001em;z-index:512;"><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_57" style="word-spacing:0.0022em;">u might run these queries: &nbsp;</span></div>
					<div class="stl_01" style="left:7.4165em;top:19.562em;"><span class="stl_265 stl_173 stl_28">SELECT * FROM tag WHERE tag='mysql'; &nbsp;</span></div>
					<div class="stl_01" style="left:7.4165em;top:20.412em;"><span class="stl_265 stl_173 stl_28">SELECT * FROM tag_post WHERE tag_id=1234; &nbsp;</span></div>
					<div class="stl_01" style="left:7.4165em;top:21.262em;"><span class="stl_265 stl_173 stl_28">SELECT * FROM post WHERE post.id in (123,456,567,9098,8904); &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:22.4001em;"><span class="stl_154 stl_32 stl_120" style="word-spacing:0.1887em;">Why on earth would you do this? It looks wasteful at first glance because you’ve &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:23.4501em;"><span class="stl_154 stl_32 stl_72" style="word-spacing:0.1085em;">increased the number of queries without getting anything in return. However, such &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:24.5001em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0014em;">restructuring can actually give significant performance advantages: &nbsp;</span></div>
					<div class="stl_01" style="left:6.7213em;top:26.3834em;"><span class="stl_154 stl_32 stl_151" style="word-spacing:0.2951em;">• Caching can be more efficient. Many applications cache “objects” that map &nbsp;</span></div>
					<div class="stl_01" style="left:7.5001em;top:27.4829em;"><span class="stl_154 stl_32 stl_88" style="word-spacing:0.19em;">directly to tables. In this example, if the object with the tag </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.0621em;">mysql </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.189em;">is already &nbsp;</span></div>
					<div class="stl_01" style="left:7.4996em;top:28.5329em;"><span class="stl_154 stl_32 stl_77" style="word-spacing:0.1043em;">cached, the application can skip the first query. If you find posts with an ID of &nbsp;</span></div>
					<div class="stl_01" style="left:7.5em;top:29.6323em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">123, 567, or 9098 in the cache, you can remove them from the </span><span class="stl_170 stl_171 stl_28">IN(</span><span class="stl_170 stl_171 stl_275">)</span><span class="stl_154 stl_32 stl_28">list. &nbsp;</span></div>
					<div class="stl_01" style="left:6.7215em;top:31.0157em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.2724em;">• Executing</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">&nbsp;</span><span class="stl_154 stl_32 stl_74" style="word-spacing:0.0016em;">the queries individually can sometimes reduce lock contention. &nbsp;</span></div>
					<div class="stl_01" style="left:6.7213em;top:32.399em;"><span class="stl_154 stl_32 stl_57" style="word-spacing:0.1562em;">• Doing joins in the application makes it easier to scale the database by placing &nbsp;</span></div>
					<div class="stl_01" style="left:7.5001em;top:33.449em;"><span class="stl_154 stl_32 stl_189" style="word-spacing:-0.001em;">tables on different servers. &nbsp;</span></div>
					<div class="stl_01" style="left:6.7216em;top:34.8818em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.2723em;">• The</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0497em;">&nbsp;</span><span class="stl_154 stl_32 stl_74" style="word-spacing:0.0514em;">queries themselves can be more efficient. In this example, using an </span><span class="stl_170 stl_171 stl_28">IN(</span><span class="stl_170 stl_171 stl_442">)</span><span class="stl_154 stl_32 stl_28">list &nbsp;</span></div>
					<div class="stl_01" style="left:7.5001em;top:35.9318em;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0314em;">instead of a join lets MySQL sort row IDs and retrieve rows more optimally than &nbsp;</span></div>
					<div class="stl_01" style="left:7.4996em;top:36.9818em;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.002em;">might be possible with a join. &nbsp;</span></div>
					<div class="stl_01" style="left:6.7211em;top:38.3651em;z-index:1423;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.2729em;">• </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_28">u</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1054em;">&nbsp;</span><span class="stl_154 stl_32 stl_83" style="word-spacing:0.1077em;">can reduce redundant row accesses. Doing a join in the application means &nbsp;</span></div>
					<div class="stl_01" style="left:7.5001em;top:39.4151em;"><span class="stl_154 stl_32 stl_37" style="word-spacing:0.1937em;">you retrieve each row only once, whereas a join in the query is essentially a &nbsp;</span></div>
					<div class="stl_01" style="left:7.4996em;top:40.4651em;"><span class="stl_154 stl_32 stl_54" style="word-spacing:0.0131em;">denormalization that might repeatedly access the same data. For the same reason, &nbsp;</span></div>
					<div class="stl_01" style="left:7.5em;top:41.5151em;"><span class="stl_154 stl_32 stl_37" style="word-spacing:-0.0004em;">such restructuring might also reduce the total network traffic and memory usage. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:43.3984em;"><span class="stl_154 stl_32 stl_57" style="word-spacing:0.0651em;">As a result, doing joins in the application can be more efficient when you cache and &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:44.4484em;"><span class="stl_154 stl_32 stl_88" style="word-spacing:0.123em;">reuse a lot of data from earlier queries, you distribute data across multiple servers, &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:45.5479em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0102em;">you replace joins with </span><span class="stl_170 stl_171 stl_28">IN(</span><span class="stl_170 stl_171 stl_420">)</span><span class="stl_154 stl_32 stl_88" style="word-spacing:0.0112em;">lists on large tables, or a join refers to the same table mul‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:46.5979em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">tiple times. &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">200 &nbsp;</span></div>
					<div class="stl_01" style="left:7.668em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:8.5755em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">Chapter 8: Query Performance Optimization &nbsp;</span></div>
					<a name="222_0" style="position:absolute;left:0em;top:8.6434em;">&nbsp;</a>
					<a name="222_1" style="position:absolute;left:0em;top:10.4794em;">&nbsp;</a>
					<a name="222_2" style="position:absolute;left:0em;top:46.8271em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>
<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_238.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_238.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:6.0002em;top:4.3166em;"><span class="stl_154 stl_32 stl_77" style="word-spacing:0.0306em;">Each of these steps has some extra complexity, which we discuss in the following sec‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:5.3666em;z-index:158;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0782em;">tions. </span><span class="stl_154 stl_32 stl_52">W</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0782em;">e </span><span class="stl_154 stl_32 stl_28">a</span><span class="stl_154 stl_32 stl_37" style="word-spacing:0.0778em;">lso explain which states the query will be in during each step. The query &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:6.4166em;"><span class="stl_154 stl_32 stl_83" style="word-spacing:0.0409em;">optimization process is particularly complex and important to understand. There are &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:7.4666em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.1197em;">also exceptions or special cases, such as the difference in execution path when you &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:8.5166em;z-index:414;"><span class="stl_154 stl_32 stl_132" style="word-spacing:0.0066em;">use prepared statements; we discuss that in the next chapter. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:10.4009em;"><span class="stl_180 stl_27 stl_28" style="word-spacing:0em;">The MySQL Client/Server Protocol &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:12.3007em;z-index:499;"><span class="stl_154 stl_32 stl_222" style="word-spacing:0.1801em;">Although you don’t need to understand the inner details of MySQ</span><span class="stl_154 stl_32 stl_94">L</span><span class="stl_154 stl_32 stl_34" style="word-spacing:0.3632em;">’s </span><span class="stl_154 stl_32 stl_28">c</span><span class="stl_154 stl_32 stl_112">lient/server &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:13.3393em;"><span class="stl_154 stl_32 stl_140" style="word-spacing:0.1456em;">protocol, you do need to know how it works at a high level. The protocol is </span><span class="stl_155 stl_41 stl_98">half- &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:14.3893em;"><span class="stl_155 stl_41 stl_215">duplex</span><span class="stl_154 stl_32 stl_35" style="word-spacing:0.1146em;">, meaning that at any given time the MySQL server can be either sending or &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:15.4507em;"><span class="stl_154 stl_32 stl_57" style="word-spacing:0.0022em;">receiving messages but not both. It also means there is no way to cut a message short. &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:17.0007em;"><span class="stl_154 stl_32 stl_77" style="word-spacing:0.054em;">This protocol makes MySQL communication simple and fast, but it limits it in some &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:18.0507em;"><span class="stl_154 stl_32 stl_108" style="word-spacing:0.0569em;">ways too. For one thing, it means there’s no flow control; once one side sends a mes‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:19.1007em;z-index:913;"><span class="stl_154 stl_32 stl_33" style="word-spacing:0.0668em;">sage, the other side must fetch the entire message before responding. It</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0626em;">s </span><span class="stl_154 stl_32 stl_28">l</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0626em;">ike a game &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:20.1507em;"><span class="stl_154 stl_32 stl_132" style="word-spacing:0.0167em;">of tossing a ball back and forth: only one side has the ball at any instant, and you can’t &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:21.2007em;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0012em;">toss the ball (send a message) unless you have it. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:22.7507em;"><span class="stl_154 stl_32 stl_122" style="word-spacing:0.1689em;">The client sends a query to the server as a single packet of data. This is why the &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:23.8501em;"><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1307em;">max_allowed_packet </span><span class="stl_154 stl_32 stl_77" style="word-spacing:0.1271em;">configuration variable is important if you have large queries.</span><sup style="top: -0.2917em;"><a href="MultiPageHTML_out224.html#224_1"><span class="stl_166 stl_32 stl_71" style="word-spacing:0.2224em;">4 &nbsp;</span></a></sup></div>
					<div class="stl_01" style="left:5.9999em;top:24.9001em;"><span class="stl_154 stl_32 stl_148" style="word-spacing:0.0547em;">Once the client sends the query, it doesn’t have the ball anymore; it can only wait for &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:25.9501em;"><span class="stl_154 stl_32 stl_28">results. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:27.5001em;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.1335em;">In contrast, the response from the server usually consists of many packets of data. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:28.5387em;"><span class="stl_154 stl_32 stl_126" style="word-spacing:0.0099em;">When the server responds, the client has to receive the </span><span class="stl_155 stl_41 stl_439" style="word-spacing:0.0332em;">entire </span><span class="stl_154 stl_32 stl_84" style="word-spacing:0.015em;">result set. It cannot sim‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:29.6001em;"><span class="stl_154 stl_32 stl_102" style="word-spacing:0.0388em;">ply fetch a few rows and then ask the server not to bother sending the rest. If the cli‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:30.6501em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0679em;">ent needs only the first few rows that are returned, it either has to wait for all of the &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:31.7001em;z-index:1545;"><span class="stl_154 stl_32 stl_104">server</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1834em;">s </span><span class="stl_154 stl_32 stl_28">p</span><span class="stl_154 stl_32 stl_114" style="word-spacing:0.1884em;">ackets to arrive and then discard the ones it doesn’t need or disconnect &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:32.7996em;"><span class="stl_154 stl_32 stl_138" style="word-spacing:0.1221em;">ungracefully. Neither is a good idea, which is why appropriate </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1404em;">LIMIT </span><span class="stl_154 stl_32 stl_33" style="word-spacing:0.1189em;">clauses are so &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:33.8496em;"><span class="stl_154 stl_32 stl_115">important. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:35.3996em;"><span class="stl_154 stl_32 stl_107" style="word-spacing:0.0648em;">Here’s another way to think about this: when a client fetches rows from the server, it &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:36.4382em;z-index:1767;"><span class="stl_154 stl_32 stl_51" style="word-spacing:0.0998em;">thinks it</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0921em;">s </span><span class="stl_155 stl_41 stl_157" style="word-spacing:0.1098em;">pulling </span><span class="stl_154 stl_32 stl_122" style="word-spacing:0.0923em;">them. But the truth is, the MySQL server is </span><span class="stl_155 stl_41 stl_422" style="word-spacing:0.1108em;">pushing </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0921em;">the rows as it &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:37.4996em;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.0354em;">generates them. The client is only receiving the pushed rows; there is no way for it to &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:38.5496em;z-index:1965;"><span class="stl_154 stl_32 stl_35" style="word-spacing:0.066em;">tell the server to stop sending rows. The client is “drinking from the fire hose</span><span class="stl_154 stl_32 stl_161">,</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0632em;">” so to &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:39.5996em;z-index:1979;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">speak. (</span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">e</span><span class="stl_154 stl_32 stl_131" style="word-spacing:0.0148em;">s, that’s a technical term.) &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:41.1496em;"><span class="stl_154 stl_32 stl_97" style="word-spacing:0.1335em;">Most libraries that connect to MySQL let you either fetch the whole result set and &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:42.1996em;"><span class="stl_154 stl_32 stl_122" style="word-spacing:0.0003em;">buffer it in memory or fetch each row as you need it. The default behavior is generally &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:43.2496em;"><span class="stl_154 stl_32 stl_72" style="word-spacing:0.0606em;">to fetch the whole result and buffer it in memory. This is important because until all &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:44.2996em;"><span class="stl_154 stl_32 stl_140" style="word-spacing:0.123em;">the rows have been fetched, the MySQL server will not release the locks and other &nbsp;</span></div>
					<div class="stl_01" style="left:6.095em;top:48.2703em;"><span class="stl_167 stl_32 stl_28">4</span></div>
					<div class="stl_01" style="left:6.6667em;top:48.1878em;z-index:79;"><span class="stl_168 stl_32 stl_74" style="word-spacing:0.0016em;">If the query is too large, the server will refuse to receive any more data and throw an error. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">202 &nbsp;</span></div>
					<div class="stl_01" style="left:7.6678em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:8.5753em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">Chapter 8: Query Performance Optimization &nbsp;</span></div>
					<a name="224_0" style="position:absolute;left:0em;top:10.694em;">&nbsp;</a>
					<a name="224_1" style="position:absolute;left:0em;top:48.2792em;">&nbsp;</a>
					<a name="224_2" style="position:absolute;left:0em;top:38.7788em;">&nbsp;</a>
					<a name="224_3" style="position:absolute;left:0em;top:12.5299em;">&nbsp;</a>
					<a name="224_4" style="position:absolute;left:0em;top:22.9799em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>
<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_92.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_92.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:6em;top:4.3166em;z-index:3;"><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_77" style="word-spacing:0.0554em;">u may also want to know the amount of bytes and rows read and written. For this &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:5.416em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0013em;">purpose, use the global status variables </span><span class="stl_170 stl_171 stl_28">Handler_*</span><span class="stl_154 stl_32 stl_28">: &nbsp;</span></div>
					<div class="stl_01" style="left:7.417em;top:7.1786em;"><span class="stl_200 stl_171 stl_28">mysql&gt; WITH rows_read AS (SELECT SUM(VARIABLE_VALUE) AS rows_read &nbsp;</span></div>
					<div class="stl_01" style="left:8.8337em;top:8.0286em;"><span class="stl_200 stl_171 stl_28">-&gt; FROM global_status &nbsp;</span></div>
					<div class="stl_01" style="left:8.8337em;top:8.8786em;"><span class="stl_200 stl_171 stl_28">-&gt; WHERE VARIABLE_NAME IN ('Handler_read_first', 'Handler_read_key', &nbsp;</span></div>
					<div class="stl_01" style="left:8.8337em;top:9.7286em;"><span class="stl_200 stl_171 stl_28">-&gt; 'Handler_read_next', 'Handler_read_last', 'Handler_read_prev', &nbsp;</span></div>
					<div class="stl_01" style="left:8.8337em;top:10.5786em;"><span class="stl_200 stl_171 stl_28">-&gt; 'Handler_read_rnd', 'Handler_read_rnd_next')), &nbsp;</span></div>
					<div class="stl_01" style="left:8.8337em;top:11.4286em;"><span class="stl_200 stl_171 stl_28">-&gt; rows_written AS (SELECT SUM(VARIABLE_VALUE) AS rows_written &nbsp;</span></div>
					<div class="stl_01" style="left:8.8337em;top:12.2786em;"><span class="stl_200 stl_171 stl_28">-&gt; FROM global_status &nbsp;</span></div>
					<div class="stl_01" style="left:8.8337em;top:13.1286em;"><span class="stl_200 stl_171 stl_28">-&gt; WHERE VARIABLE_NAME IN ('Handler_write')) &nbsp;</span></div>
					<div class="stl_01" style="left:8.8337em;top:13.9786em;"><span class="stl_200 stl_171 stl_28">-&gt; SELECT * FROM rows_read, rows_written\G &nbsp;</span></div>
					<div class="stl_01" style="left:7.417em;top:14.8286em;"><span class="stl_200 stl_171 stl_28">*************************** 1. row *************************** &nbsp;</span></div>
					<div class="stl_01" style="left:7.417em;top:15.6786em;"><span class="stl_200 stl_171 stl_28">rows_read: 169358114082 &nbsp;</span></div>
					<div class="stl_01" style="left:7.417em;top:16.5286em;"><span class="stl_200 stl_171 stl_28">rows_written: 33038251685 &nbsp;</span></div>
					<div class="stl_01" style="left:7.417em;top:17.3786em;"><span class="stl_200 stl_171 stl_28">1 row in set (0.00 sec) &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:18.8503em;"><span class="stl_180 stl_27 stl_28" style="word-spacing:0em;">Examining Metadata Locks &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:20.7501em;"><span class="stl_154 stl_32 stl_35" style="word-spacing:0.1931em;">Metadata locks are used to protect database object definitions from modification. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:21.8495em;"><span class="stl_154 stl_32 stl_84" style="word-spacing:0.1729em;">Shared metadata locks are set for any SQL statement: </span><span class="stl_170 stl_171 stl_28">SELECT</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1683em;">, </span><span class="stl_170 stl_171 stl_28">UPDATE</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1683em;">, and so on. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:22.8995em;z-index:863;"><span class="stl_154 stl_32 stl_71" style="word-spacing:0.1773em;">They do not affect other statements that require shared metadata locks. However, &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:23.9495em;"><span class="stl_154 stl_32 stl_77" style="word-spacing:0.2073em;">they prevent those statements that change the database object definition, such as &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:25.049em;"><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.0224em;">ALTER TABLE </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1054em;">or </span><span class="stl_170 stl_171 stl_28" style="word-spacing:0.1054em;">CREATE INDEX</span><span class="stl_154 stl_32 stl_53" style="word-spacing:0.1065em;">, from starting until the lock is freed. While most of &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:26.099em;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0469em;">the issues caused by metadata lock conflicts affect tables, the locks themselves are set &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:27.1984em;"><span class="stl_154 stl_32 stl_54" style="word-spacing:0.004em;">for any database object, such as </span><span class="stl_170 stl_171 stl_28">SCHEMA</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">, </span><span class="stl_170 stl_171 stl_28">EVENT</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">, </span><span class="stl_170 stl_171 stl_28">TABLESPACE</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">, and so on. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:28.7484em;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.1573em;">Metadata locks are held until the transaction finishes. This makes troubleshooting &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:29.7984em;"><span class="stl_154 stl_32 stl_77" style="word-spacing:0.0971em;">them harder if you use multiple statement transactions. Which statement is waiting &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:30.8484em;"><span class="stl_154 stl_32 stl_88" style="word-spacing:0.0722em;">for the lock is usually clear: DDL statements implicitly commit transactions, so they &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:31.8984em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0659em;">are the only statement in the new transaction, and you will find them in the process &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:32.9979em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.2023em;">list in the </span><span class="stl_170 stl_171 stl_28" style="word-spacing:0.1523em;">"Waiting for a metadata lock" </span><span class="stl_154 stl_32 stl_82" style="word-spacing:0.215em;">status. However, the statement that &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:34.0479em;"><span class="stl_154 stl_32 stl_35" style="word-spacing:0.0665em;">holds the lock may vanish from the process list if it is part of the multiple statement &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:35.0979em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.0017em;">transaction that is still open. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:36.6973em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1942em;">The </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.0566em;">metadata_locks </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1942em;">table in </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.0566em;">performance_schema </span><span class="stl_154 stl_32 stl_95" style="word-spacing:0.1959em;">holds information about locks &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:37.7473em;"><span class="stl_154 stl_32 stl_46" style="word-spacing:0.1167em;">that are currently set by different threads, and it also holds information about lock &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:38.7973em;"><span class="stl_154 stl_32 stl_54" style="word-spacing:0.0689em;">requests that are waiting for the lock. This way, you can easily identify which thread &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:39.8473em;"><span class="stl_154 stl_32 stl_57" style="word-spacing:0.0219em;">does not allow your DDL request to start and decide if you want to kill this statement &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:40.8973em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.0015em;">or wait until it finishes executing. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:42.4967em;"><span class="stl_154 stl_32 stl_105" style="word-spacing:0.336em;">To </span><span class="stl_154 stl_32 stl_28">e</span><span class="stl_154 stl_32 stl_35" style="word-spacing:0.1427em;">nable metadata lock instrumentation, you need to enable the </span><span class="stl_170 stl_171 stl_28">wait/lock/meta &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:43.5962em;"><span class="stl_170 stl_171 stl_28">data/sql/md</span><span class="stl_170 stl_171 stl_186">l</span><span class="stl_154 stl_32 stl_36">instrument. &nbsp;</span></div>
					<div class="stl_01" style="left:27.0035em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">Using Performance Schema &nbsp;</span></div>
					<div class="stl_01" style="left:34.4803em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:35.3878em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">63 &nbsp;</span></div>
					<a name="85_0" style="position:absolute;left:0em;top:19.1434em;">&nbsp;</a>
					<a name="85_1" style="position:absolute;left:0em;top:20.9794em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>
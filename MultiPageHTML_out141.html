<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_147.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_147.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:6em;top:4.3166em;"><span class="stl_154 stl_32 stl_88" style="word-spacing:0.1072em;">good RAID controller with a large enough battery-backed write cache can improve &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:5.3666em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.0692em;">performance dramatically and is a very good investment. Of course, solid-state stor‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:6.4166em;"><span class="stl_154 stl_32 stl_46" style="word-spacing:0.046em;">age is also the recommended solution at this point, which dramatically improves I/O &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:7.4666em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">performance as well. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:9.3631em;"><span class="stl_160 stl_27 stl_28" style="word-spacing:-0.092em;">Conﬁguring </span><span class="stl_159 stl_27 stl_28" style="word-spacing:0em;">MySQL Concurrency &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:11.6333em;"><span class="stl_154 stl_32 stl_143" style="word-spacing:0.1073em;">When you’re running MySQL in a high-concurrency workload, you might run into &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:12.6833em;"><span class="stl_154 stl_32 stl_35" style="word-spacing:0.1181em;">bottlenecks you wouldn’t otherwise experience. This section explains how to detect &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:13.7333em;"><span class="stl_154 stl_32 stl_140" style="word-spacing:0.1961em;">these problems when they happen and how to get the best performance possible &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:14.7833em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">under these workloads. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:16.3333em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.1618em;">If you have problems with InnoDB concurrency and you are not running at least &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:17.3833em;"><span class="stl_154 stl_32 stl_57" style="word-spacing:0.0057em;">MySQL 5.7, the solution is usually to upgrade the server. Older versions still held a lot &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:18.4333em;"><span class="stl_154 stl_32 stl_87" style="word-spacing:0.2312em;">of high concurrency scalability challenges. Everything queued on global mutexes &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:19.4833em;"><span class="stl_154 stl_32 stl_37" style="word-spacing:0.1649em;">such as the buffer pool mutex, and the server practically ground to a halt. If you &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:20.5333em;"><span class="stl_154 stl_32 stl_143" style="word-spacing:0.0338em;">upgrade to one of the newer versions of MySQL, you don’t need to limit concurrency &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:21.5833em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">in most cases. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:23.1333em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.0701em;">If you find yourself hitting this bottleneck, your best option is to shard your data. If &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:24.1833em;"><span class="stl_154 stl_32 stl_97" style="word-spacing:0.1166em;">sharding is not a viable path forward, you may need to limit concurrency. InnoDB &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:25.2333em;"><span class="stl_154 stl_32 stl_39" style="word-spacing:0.1411em;">has its own “thread scheduler” that controls how threads enter its kernel to access &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:26.2833em;"><span class="stl_154 stl_32 stl_33" style="word-spacing:0.0325em;">data and what they can do once they’re inside the kernel. The most basic way to limit &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:27.3827em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.2533em;">concurrency is with the </span><span class="stl_170 stl_171 stl_28" style="word-spacing:0.0056em;">innodb_thread_concurrency </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.2533em;">variable, which limits how &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:28.4822em;"><span class="stl_154 stl_32 stl_35" style="word-spacing:0.0186em;">many threads can be in the kernel at once. A value of </span><span class="stl_170 stl_171 stl_241">0</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0158em;">means there is no limit on the &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:29.5322em;"><span class="stl_154 stl_32 stl_46" style="word-spacing:0.0235em;">number of threads. If you are having InnoDB concurrency problems in older MySQL &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:30.5822em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.0017em;">versions, this variable is the most important one to configure. &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:32.1322em;z-index:1437;"><a href="https://oreil.ly/ThOBP" target="_blank"><span class="stl_184 stl_32 stl_93">MySQ</span></a><a href="https://oreil.ly/ThOBP" target="_blank"><span class="stl_184 stl_32 stl_94">L</span></a><a href="https://oreil.ly/ThOBP" target="_blank"><span class="stl_184 stl_32 stl_34" style="word-spacing:0.309em;">’s </span></a><a href="https://oreil.ly/ThOBP" target="_blank"><span class="stl_184 stl_32 stl_28">o</span></a><a href="https://oreil.ly/ThOBP" target="_blank"><span class="stl_184 stl_32 stl_38" style="word-spacing:0.1237em;">nline documentation </span></a><span class="stl_154 stl_32 stl_53" style="word-spacing:0.1201em;">provides the best guide for configuration here. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_28">u &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:33.1822em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0413em;">will have to experiment to find the best value for your system, but our recommenda‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:34.2816em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0218em;">tion is to start with setting </span><span class="stl_170 stl_171 stl_28">innodb_thread_concurrenc</span><span class="stl_170 stl_171 stl_376">y</span><span class="stl_154 stl_32 stl_35" style="word-spacing:0.0245em;">to the same number of CPU &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:35.3316em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.0017em;">cores you have available and then begin tuning up or down as needed. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:36.8816em;"><span class="stl_154 stl_32 stl_114" style="word-spacing:0.0814em;">If more than the allowed number of threads are already in the kernel, a thread can’t &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:37.9316em;"><span class="stl_154 stl_32 stl_87" style="word-spacing:0.0698em;">enter the kernel. InnoDB uses a two-phase process to try to let threads enter as effi‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:38.9816em;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.141em;">ciently as possible. The two-phase policy reduces the overhead of context switches &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:40.0316em;"><span class="stl_154 stl_32 stl_33" style="word-spacing:0.7208em;">caused by the operating system scheduler. The thread first sleeps for &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:41.131em;z-index:1977;"><span class="stl_170 stl_171 stl_28">innodb_thread_sleep_dela</span><span class="stl_170 stl_171 stl_272">y</span><span class="stl_154 stl_32 stl_150" style="word-spacing:0.0536em;">microseconds and then tries again. If it still can’t enter, &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:42.181em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.0016em;">it goes into a queue of waiting threads and yields to the operating system. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:43.731em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.0502em;">The default sleep time in the first phase is 10,000 microseconds. Changing this value &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:44.781em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.087em;">can help in high-concurrency environments, when the CPU is underused with a lot &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:45.831em;"><span class="stl_154 stl_32 stl_71" style="word-spacing:0.0144em;">of threads in the “sleeping before entering queue” status. The default value can also be &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:46.881em;z-index:2319;"><span class="stl_154 stl_32 stl_38" style="word-spacing:0.0048em;">much too large if you have a lot of small queries because it adds to query latency. &nbsp;</span></div>
					<div class="stl_01" style="left:25.6118em;top:50.8098em;"><span class="stl_233 stl_27 stl_28" style="word-spacing:-0.092em;">Conﬁguring </span><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">MySQL Concurrency &nbsp;</span></div>
					<div class="stl_01" style="left:34.1745em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:35.082em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">119 &nbsp;</span></div>
					<a name="141_0" style="position:absolute;left:0em;top:9.7147em;">&nbsp;</a>
					<a name="141_1" style="position:absolute;left:0em;top:11.8625em;">&nbsp;</a>
					<a name="141_2" style="position:absolute;left:0em;top:7.6958em;">&nbsp;</a>
					<a name="141_3" style="position:absolute;left:0em;top:23.3625em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>
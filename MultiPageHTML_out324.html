<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_352.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_352.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:6em;top:4.1653em;"><span class="stl_180 stl_27 stl_28" style="word-spacing:0em;">Multiple Partitioning Keys &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:6.065em;"><span class="stl_154 stl_32 stl_71" style="word-spacing:0.0476em;">Complicated data models make data sharding more difficult. Many applications have &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:7.115em;"><span class="stl_154 stl_32 stl_33" style="word-spacing:0.2979em;">more than one partitioning key, especially if there are two or more important &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:8.165em;"><span class="stl_154 stl_32 stl_43" style="word-spacing:0.1059em;">“dimensions” in the data. In other words, the application might need to see an effi‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:9.215em;"><span class="stl_154 stl_32 stl_39" style="word-spacing:0.0494em;">cient, coherent view of the data from different angles. This means you might need to &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:10.265em;"><span class="stl_154 stl_32 stl_83" style="word-spacing:0.0024em;">store at least some data twice within the system. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:11.815em;z-index:397;"><span class="stl_154 stl_32 stl_162" style="word-spacing:0.124em;">For example, you might need to shard your blogging application</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.116em;">s </span><span class="stl_154 stl_32 stl_28">d</span><span class="stl_154 stl_32 stl_38" style="word-spacing:0.1207em;">ata by both the &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:12.865em;"><span class="stl_154 stl_32 stl_48" style="word-spacing:0.0379em;">user ID and the post ID because these are two common ways the application looks at &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:13.915em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.0849em;">the data. Think of it this way: you frequently want to see all posts for a user and all &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:14.965em;"><span class="stl_154 stl_32 stl_47" style="word-spacing:0.1247em;">comments for a post. Sharding by user doesn’t help you find comments for a post, &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:16.015em;"><span class="stl_154 stl_32 stl_124" style="word-spacing:0.0482em;">and sharding by post doesn’t help you find posts for a user. If you need both types of &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:17.065em;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.002em;">queries to touch only a single shard, you’ll have to shard both ways. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:18.615em;"><span class="stl_154 stl_32 stl_132" style="word-spacing:0.0924em;">Just because you need multiple partitioning keys doesn’t mean you’ll need to design &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:19.665em;z-index:847;"><span class="stl_154 stl_32 stl_24" style="word-spacing:0.1686em;">two completely redundant data stores. Let</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1632em;">s </span><span class="stl_154 stl_32 stl_28">l</span><span class="stl_154 stl_32 stl_77" style="word-spacing:0.1664em;">ook at another example: a social net‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:20.715em;z-index:916;"><span class="stl_154 stl_32 stl_36" style="word-spacing:0.0121em;">working book-club website where the site</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0082em;">s </span><span class="stl_154 stl_32 stl_28">u</span><span class="stl_154 stl_32 stl_74" style="word-spacing:0.0097em;">sers can comment on books. The website &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:21.7651em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.0135em;">can display all comments for a book as well as all books a user has read and commen‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:22.8151em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">ted on. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:24.3651em;z-index:1024;"><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_83" style="word-spacing:0.108em;">u might build one sharded data store for the user data and another for the book &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:25.4151em;"><span class="stl_154 stl_32 stl_54" style="word-spacing:0.1571em;">data. Comments have both a user ID and a post ID, so they cross the boundaries &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:26.4651em;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.0275em;">between shards. Instead of completely duplicating comments, you can store the com‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:27.5151em;z-index:1272;"><span class="stl_154 stl_32 stl_84" style="word-spacing:0.0553em;">ments with the user data. Then you can store just a comment</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0507em;">s </span><span class="stl_154 stl_32 stl_28">h</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0507em;">eadline and ID with &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:28.5651em;z-index:1344;"><span class="stl_154 stl_32 stl_54" style="word-spacing:0.1597em;">the book data. This might be enough to render most views of a book</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1558em;">s </span><span class="stl_154 stl_32 stl_28">c</span><span class="stl_154 stl_32 stl_99">omments &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:29.6151em;"><span class="stl_154 stl_32 stl_46" style="word-spacing:0.0374em;">without accessing both data stores, and if you need to display the complete comment &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:30.6651em;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0012em;">text, you can retrieve it from the user data store. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0006em;top:32.5494em;"><span class="stl_180 stl_27 stl_28" style="word-spacing:0em;">Querying Across Shards &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:34.4491em;"><span class="stl_154 stl_32 stl_114" style="word-spacing:0.1077em;">Most sharded applications have at least some queries that need to aggregate or join &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:35.4991em;"><span class="stl_154 stl_32 stl_46" style="word-spacing:0.028em;">data from multiple shards. For example, if the book-club site shows the most popular &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:36.5491em;"><span class="stl_154 stl_32 stl_122" style="word-spacing:0.1038em;">or active users, it must by definition access every shard. Making such queries work &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:37.5991em;"><span class="stl_154 stl_32 stl_54" style="word-spacing:0.0585em;">well is the most difficult part of implementing data sharding because what the appli‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:38.6491em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.1267em;">cation sees as a single query needs to be split up and executed in parallel as many &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:39.6991em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0548em;">queries, one per shard. A good database abstraction layer can help ease the pain, but &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:40.7491em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.017em;">even then such queries are so much slower and more expensive than in-shard queries &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:41.7991em;"><span class="stl_154 stl_32 stl_126" style="word-spacing:-0.0005em;">that aggressive caching is usually necessary as well. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:43.3491em;z-index:2022;"><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_140" style="word-spacing:0.0434em;">u will know that the sharding scheme you chose was a good one if the cross-shard &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:44.3991em;z-index:2125;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0558em;">queries become outliers instead of norms. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0558em;">u should strive to make your queries as &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:45.4491em;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.0111em;">simple as possible and contained within one shard. For those cases where some cross- &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:46.4991em;"><span class="stl_154 stl_32 stl_35" style="word-spacing:0.128em;">shard aggregation is needed, we recommend you make that part of the application &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:47.5491em;"><span class="stl_154 stl_32 stl_28">logic. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">302 &nbsp;</span></div>
					<div class="stl_01" style="left:7.6678em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:8.5753em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">Chapter 11: Scaling MySQL &nbsp;</span></div>
					<a name="324_0" style="position:absolute;left:0em;top:4.4583em;">&nbsp;</a>
					<a name="324_1" style="position:absolute;left:0em;top:32.8424em;">&nbsp;</a>
					<a name="324_2" style="position:absolute;left:0em;top:6.2943em;">&nbsp;</a>
					<a name="324_3" style="position:absolute;left:0em;top:34.6784em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>
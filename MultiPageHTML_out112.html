<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_118.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_118.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:5.9998em;top:4.3166em;"><span class="stl_154 stl_32 stl_117" style="word-spacing:0.034em;">other two choices are suitable for server-class hardware, and in most cases they work &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:5.416em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1057em;">about equally well. The </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1498em;">noop </span><span class="stl_154 stl_32 stl_97" style="word-spacing:0.1088em;">scheduler is appropriate for devices that do their own &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:6.466em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.1242em;">scheduling behind the scenes, such as hardware RAID controllers and storage area &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:7.5655em;"><span class="stl_154 stl_32 stl_48" style="word-spacing:0.0727em;">networks (SANs), and </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1883em;">deadline </span><span class="stl_154 stl_32 stl_83" style="word-spacing:0.0714em;">is fine for both RAID controllers and disks that are &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:8.6155em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.0247em;">directly attached. Our benchmarks show very little difference between these two. The &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:9.7149em;"><span class="stl_154 stl_32 stl_83" style="word-spacing:0.0023em;">main thing is to use anything but </span><span class="stl_170 stl_171 stl_28">cfq</span><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0012em;">, which can cause severe performance problems. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0005em;top:11.5992em;"><span class="stl_180 stl_27 stl_28" style="word-spacing:0em;">Memory and Swapping &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:13.499em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.063em;">MySQL performs best with a large amount of memory allocated to it. As we learned &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:14.549em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0634em;">in </span><a href="MultiPageHTML_out23.html#23_0"><span class="stl_184 stl_32 stl_24" style="word-spacing:0.0689em;">Chapter 1</span></a><span class="stl_154 stl_32 stl_87" style="word-spacing:0.0638em;">, InnoDB uses memory as a cache to avoid disk access. This means that &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:15.599em;"><span class="stl_154 stl_32 stl_87" style="word-spacing:0.0424em;">the performance of the memory system can have a direct impact on how fast queries &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:16.649em;"><span class="stl_154 stl_32 stl_46" style="word-spacing:0.0397em;">are served. Even today, one of the best ways to ensure faster memory access has been &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:17.7484em;"><span class="stl_154 stl_32 stl_126" style="word-spacing:0.0598em;">to replace the built-in memory allocator (</span><span class="stl_170 stl_171 stl_28">glibc</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0605em;">) with an external one such as </span><span class="stl_170 stl_171 stl_28">tcmal &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:18.8479em;"><span class="stl_170 stl_171 stl_28" style="word-spacing:0.0569em;">loc </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.302em;">or </span><span class="stl_170 stl_171 stl_28">jemalloc</span><span class="stl_154 stl_32 stl_54" style="word-spacing:0.3061em;">. Numerous benchmarks</span><sup style="top: -0.2917em;"><a href="MultiPageHTML_out112.html#112_1"><span class="stl_166 stl_32 stl_28" style="word-spacing:0.6988em;">2 </span></a></sup><span class="stl_154 stl_32 stl_39" style="word-spacing:0.3054em;">have shown that both of these offer &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:19.8979em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.1954em;">improved performance and reduced memory fragmentation when compared with &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:20.9973em;"><span class="stl_170 stl_171 stl_28">glibc</span><span class="stl_154 stl_32 stl_28">. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:22.5473em;"><span class="stl_154 stl_32 stl_87" style="word-spacing:0.195em;">Swapping occurs when the operating system writes some virtual memory to disk &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:23.5973em;"><span class="stl_154 stl_32 stl_99" style="word-spacing:0.0865em;">because it doesn’t have enough physical memory to hold it. Swapping is transparent &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:24.6473em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.2134em;">to processes running on the operating system. Only the operating system knows &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:25.6973em;"><span class="stl_154 stl_32 stl_188" style="word-spacing:-0.0013em;">whether a particular virtual memory address is in physical memory or on disk. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:27.2473em;"><span class="stl_154 stl_32 stl_72" style="word-spacing:0.0497em;">When using SSDs, the performance penalty isn’t nearly as sharp as it used to be with &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:28.2973em;z-index:1367;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1334em;">HDDs. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_88" style="word-spacing:0.1344em;">u should still actively avoid swapping—even if just to avoid unnecessary &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:29.3473em;z-index:1479;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.022em;">writes that may shorten the overall life span of the disk. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_57" style="word-spacing:0.0222em;">u may also consider taking &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:30.3973em;"><span class="stl_154 stl_32 stl_77" style="word-spacing:0.1036em;">the approach of using no swap, which forgoes the potential altogether but does put &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:31.4473em;"><span class="stl_154 stl_32 stl_88" style="word-spacing:0.001em;">you in a situation where running out of memory may lead to process termination. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:32.9859em;"><span class="stl_154 stl_32 stl_46" style="word-spacing:0.0446em;">On GNU/Linux, you can monitor swapping with </span><span class="stl_155 stl_41 stl_81" style="word-spacing:0.0517em;">vmstat </span><span class="stl_154 stl_32 stl_83" style="word-spacing:0.0444em;">(we show some examples in &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:34.0967em;z-index:1718;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0289em;">the next section). </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_222" style="word-spacing:0.0357em;">u need to look at the swap I/O activity, reported in the </span><span class="stl_170 stl_171 stl_28">s</span><span class="stl_170 stl_171 stl_270">i</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0295em;">and </span><span class="stl_170 stl_171 stl_28">so &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:35.1962em;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.0131em;">columns, rather than the swap usage, which is reported in the </span><span class="stl_170 stl_171 stl_28">swp</span><span class="stl_170 stl_171 stl_335">d</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0114em;">column. The </span><span class="stl_170 stl_171 stl_28">swpd &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:36.2462em;"><span class="stl_154 stl_32 stl_71" style="word-spacing:0.1181em;">column can show processes that have been loaded but aren’t being used, which are &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:37.3456em;z-index:1929;"><span class="stl_154 stl_32 stl_57" style="word-spacing:0.0425em;">not really problematic. </span><span class="stl_154 stl_32 stl_52">W</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0404em;">e </span><span class="stl_154 stl_32 stl_28">l</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0404em;">ike the </span><span class="stl_170 stl_171 stl_28">s</span><span class="stl_170 stl_171 stl_336">i</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0404em;">and </span><span class="stl_170 stl_171 stl_28">s</span><span class="stl_170 stl_171 stl_336">o</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0404em;">column values to be </span><span class="stl_170 stl_171 stl_28">0</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0404em;">, and they should &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:38.3956em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">definitely be less than 10 blocks per second. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:39.9456em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.0248em;">In extreme cases, too much memory allocation can cause the operating system to run &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:40.9956em;"><span class="stl_154 stl_32 stl_87" style="word-spacing:0.147em;">out of swap space. If this happens, the resulting lack of virtual memory can crash &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:42.0456em;"><span class="stl_154 stl_32 stl_222" style="word-spacing:0.0679em;">MySQL. But even if it doesn’t run out of swap space, very active swapping can cause &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:43.0956em;"><span class="stl_154 stl_32 stl_222" style="word-spacing:0.0615em;">the entire operating system to become unresponsive, to the point that you can’t even &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:44.1456em;"><span class="stl_154 stl_32 stl_57" style="word-spacing:0.2455em;">log in and kill the MySQL process. Sometimes the Linux kernel can even hang &nbsp;</span></div>
					<div class="stl_01" style="left:6.095em;top:47.4369em;"><span class="stl_167 stl_32 stl_28">2</span></div>
					<div class="stl_01" style="left:6.6667em;top:47.3545em;"><span class="stl_168 stl_32 stl_28" style="word-spacing:0em;">See the blog posts </span><a href="https://oreil.ly/AAJHX" target="_blank"><span class="stl_187 stl_32 stl_115" style="word-spacing:0.0085em;">“Impact of Memory Allocators on MySQL Performance” </span></a><span class="stl_168 stl_32 stl_28" style="word-spacing:0em;">and </span><a href="https://oreil.ly/slp7v" target="_blank"><span class="stl_187 stl_32 stl_214" style="word-spacing:0.0135em;">“MySQL (or Percona) Mem‐ &nbsp;</span></a></div>
					<div class="stl_01" style="left:6.6667em;top:48.1878em;z-index:96;"><a href="https://oreil.ly/slp7v" target="_blank"><span class="stl_187 stl_32 stl_162" style="word-spacing:0.008em;">ory Usage </span></a><a href="https://oreil.ly/slp7v" target="_blank"><span class="stl_187 stl_32 stl_105">T</span></a><a href="https://oreil.ly/slp7v" target="_blank"><span class="stl_187 stl_32 stl_28">e</span></a><a href="https://oreil.ly/slp7v" target="_blank"><span class="stl_187 stl_32 stl_18" style="word-spacing:0.0273em;">sts” </span></a><span class="stl_168 stl_32 stl_97" style="word-spacing:0.0029em;">for comparisons. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">90 &nbsp;</span></div>
					<div class="stl_01" style="left:7.3624em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:8.2699em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">Chapter 4: Operating System and Hardware Optimization &nbsp;</span></div>
					<a name="112_0" style="position:absolute;left:0em;top:11.8923em;">&nbsp;</a>
					<a name="112_1" style="position:absolute;left:0em;top:47.4458em;">&nbsp;</a>
					<a name="112_2" style="position:absolute;left:0em;top:5.6453em;">&nbsp;</a>
					<a name="112_3" style="position:absolute;left:0em;top:13.7282em;">&nbsp;</a>
					<a name="112_4" style="position:absolute;left:0em;top:17.9777em;">&nbsp;</a>
					<a name="112_5" style="position:absolute;left:0em;top:22.7765em;">&nbsp;</a>
					<a name="112_6" style="position:absolute;left:0em;top:27.4766em;">&nbsp;</a>
					<a name="112_7" style="position:absolute;left:0em;top:33.2266em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>
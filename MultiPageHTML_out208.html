<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_221.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_221.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:7.4167em;top:4.5292em;"><span class="stl_200 stl_171 stl_28">| sakila &nbsp;</span></div>
					<div class="stl_01" style="left:7.4167em;top:5.3792em;"><span class="stl_200 stl_171 stl_28">| sakila &nbsp;</span></div>
					<div class="stl_01" style="left:7.4167em;top:6.2292em;"><span class="stl_200 stl_171 stl_28">| sakila &nbsp;</span></div>
					<div class="stl_01" style="left:13.0833em;top:4.5292em;"><span class="stl_200 stl_171 stl_28">| address &nbsp;</span></div>
					<div class="stl_01" style="left:13.0833em;top:5.3792em;"><span class="stl_200 stl_171 stl_28">| address &nbsp;</span></div>
					<div class="stl_01" style="left:13.0833em;top:6.2292em;"><span class="stl_200 stl_171 stl_28">| payment &nbsp;</span></div>
					<div class="stl_01" style="left:18.75em;top:4.5292em;"><span class="stl_200 stl_171 stl_28">| idx_fk_city_id &nbsp;</span></div>
					<div class="stl_01" style="left:18.75em;top:5.3792em;"><span class="stl_200 stl_171 stl_28">| idx_location &nbsp;</span></div>
					<div class="stl_01" style="left:18.75em;top:6.2292em;"><span class="stl_200 stl_171 stl_28">| fk_payment_rental &nbsp;</span></div>
					<div class="stl_01" style="left:29.375em;top:4.5292em;"><span class="stl_200 stl_171 stl_28">|</span></div>
					<div class="stl_01" style="left:29.375em;top:5.3792em;"><span class="stl_200 stl_171 stl_28">|</span></div>
					<div class="stl_01" style="left:29.375em;top:6.2292em;"><span class="stl_200 stl_171 stl_28">|</span></div>
					<div class="stl_01" style="left:7.4167em;top:7.0792em;"><span class="stl_200 stl_171 stl_28">.. trimmed for brevity .. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:8.5631em;"><span class="stl_159 stl_27 stl_28" style="word-spacing:0em;">Index and Table Maintenance &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:10.8333em;"><span class="stl_154 stl_32 stl_138" style="word-spacing:0.0388em;">Once you’ve created tables with proper data types and added indexes, your work isn’t &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:11.8833em;"><span class="stl_154 stl_32 stl_117" style="word-spacing:0.096em;">over: you still need to maintain your tables and indexes to make sure they perform &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:12.9333em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.1251em;">well. The three main goals of table maintenance are finding and fixing corruption, &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:13.9833em;"><span class="stl_154 stl_32 stl_48" style="word-spacing:0.0036em;">maintaining accurate index statistics, and reducing fragmentation. &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:15.8676em;"><span class="stl_180 stl_27 stl_28" style="word-spacing:0em;">Finding and Repairing Table Corruption &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:17.7674em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.1643em;">The worst thing that can happen to a table is corruption. All storage engines can &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:18.8174em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.0124em;">experience index corruption due to hardware problems or internal bugs in MySQL or &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:19.8674em;"><span class="stl_154 stl_32 stl_122" style="word-spacing:0.0003em;">the operating system, although it is very rare to experience them in InnoDB. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:21.4174em;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.1155em;">Corrupted indexes can cause queries to return incorrect results, raise duplicate-key &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:22.4674em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.1007em;">errors when there is no duplicated value, or even cause lockups and crashes. If you &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:23.5174em;"><span class="stl_154 stl_32 stl_124" style="word-spacing:0.0812em;">experience odd behavior—such as an error that you think shouldn’t be happening— &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:24.6168em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0554em;">run </span><span class="stl_170 stl_171 stl_28" style="word-spacing:0.0554em;">CHECK TABL</span><span class="stl_170 stl_171 stl_203">E</span><span class="stl_154 stl_32 stl_43" style="word-spacing:0.0626em;">to see if the table is corrupt. (Note that some storage engines don’t &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:25.6668em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1749em;">support this command, and others support multiple options to specify how thor‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:26.7663em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.2177em;">oughly they check the table.) </span><span class="stl_170 stl_171 stl_28" style="word-spacing:0.0929em;">CHECK TABLE </span><span class="stl_154 stl_32 stl_74" style="word-spacing:0.2192em;">usually catches most table and index &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:27.8163em;"><span class="stl_154 stl_32 stl_28">errors. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:29.4157em;z-index:1066;"><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0007em;">u can fix corrupt tables with the </span><span class="stl_170 stl_171 stl_28" style="word-spacing:0em;">REPAIR TABL</span><span class="stl_170 stl_171 stl_259">E</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">command, but again, not all storage &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:30.5151em;"><span class="stl_154 stl_32 stl_71" style="word-spacing:0.121em;">engines support this. In these cases you can do a “no-op” </span><span class="stl_170 stl_171 stl_28">ALTER</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1152em;">, such as altering a &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:31.5651em;z-index:1254;"><span class="stl_154 stl_32 stl_114" style="word-spacing:0.2278em;">table to use the same storage engine it currently uses. Here</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.2227em;">s </span><span class="stl_154 stl_32 stl_28">a</span><span class="stl_154 stl_32 stl_33" style="word-spacing:0.2269em;">n example for an &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:32.6151em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">InnoDB table: &nbsp;</span></div>
					<div class="stl_01" style="left:7.4164em;top:34.3777em;"><span class="stl_200 stl_171 stl_28">ALTER TABLE &lt;table&gt; ENGINE=INNODB; &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:35.5151em;"><span class="stl_154 stl_32 stl_162" style="word-spacing:0.0976em;">Alternatively, you can dump the data and reload it. However, if the corruption is in &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:36.5651em;z-index:1407;"><span class="stl_154 stl_32 stl_120" style="word-spacing:0.1187em;">the system area or in the table</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_85" style="word-spacing:0.1221em;">s “row data” area instead of the index, you might be &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:37.6151em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.0918em;">unable to use any of these options. In this case, you might need to restore the table &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:38.6651em;"><span class="stl_154 stl_32 stl_83" style="word-spacing:0.0024em;">from your backups or attempt to recover data from the corrupted files. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:40.2151em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0401em;">If you experience corruption with the InnoDB storage engine, something is seriously &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:41.2651em;"><span class="stl_154 stl_32 stl_129" style="word-spacing:0.146em;">wrong and you need to investigate it right away. InnoDB simply shouldn’t become &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:42.3151em;"><span class="stl_154 stl_32 stl_88" style="word-spacing:0.1423em;">corrupt. Its design makes it very resilient to corruption. Corruption is evidence of &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:43.3651em;"><span class="stl_154 stl_32 stl_37" style="word-spacing:0.1279em;">either a hardware problem such as bad memory or disks (likely), an administrator &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:44.4151em;"><span class="stl_154 stl_32 stl_83" style="word-spacing:0.2008em;">error such as manipulating the database files externally to MySQL (likely), or an &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:45.4651em;"><span class="stl_154 stl_32 stl_37" style="word-spacing:0.0048em;">InnoDB bug (unlikely). The usual causes are mistakes such as trying to make backups &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:46.5038em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">with </span><span class="stl_155 stl_41 stl_83">rsync</span><span class="stl_154 stl_32 stl_87" style="word-spacing:0.0003em;">. There is no query you can execute—none—that you are supposed to avoid &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:47.5651em;z-index:2090;"><span class="stl_154 stl_32 stl_123" style="word-spacing:0.1065em;">because it’ll corrupt InnoDB</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1013em;">s </span><span class="stl_154 stl_32 stl_28">d</span><span class="stl_154 stl_32 stl_48" style="word-spacing:0.1049em;">ata. There is no hidden gun pointed at your foot. If &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">186 &nbsp;</span></div>
					<div class="stl_01" style="left:7.668em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:8.5755em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">Chapter 7: Indexing for High Performance &nbsp;</span></div>
					<a name="208_0" style="position:absolute;left:0em;top:8.9147em;">&nbsp;</a>
					<a name="208_1" style="position:absolute;left:0em;top:16.1607em;">&nbsp;</a>
					<a name="208_2" style="position:absolute;left:0em;top:17.9966em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>
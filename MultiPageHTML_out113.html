<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_119.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_119.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:5.9998em;top:4.3166em;z-index:63;"><span class="stl_154 stl_32 stl_35" style="word-spacing:0.0828em;">completely when it runs out of swap space. </span><span class="stl_154 stl_32 stl_52">W</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.08em;">e </span><span class="stl_154 stl_32 stl_28">r</span><span class="stl_154 stl_32 stl_95" style="word-spacing:0.0817em;">ecommend you run your databases &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:5.3666em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0247em;">without using swap space at all. Disk is still an order of magnitude slower than RAM, &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:6.4166em;"><span class="stl_154 stl_32 stl_57" style="word-spacing:0.0021em;">and this avoids all of the headaches mentioned here. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:7.9666em;"><span class="stl_154 stl_32 stl_88" style="word-spacing:0.179em;">Another thing that frequently happens under extreme virtual memory pressure is &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:9.0166em;"><span class="stl_154 stl_32 stl_189" style="word-spacing:0.0321em;">that the out-of-memory (OOM) killer process will kick in and kill something. This is &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:10.0666em;"><span class="stl_154 stl_32 stl_46" style="word-spacing:0.0963em;">frequently MySQL, but it can also be another process such as SSH, which can leave &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:11.1166em;z-index:461;"><span class="stl_154 stl_32 stl_132" style="word-spacing:0.0327em;">you with a system that</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0261em;">s </span><span class="stl_154 stl_32 stl_28">n</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0261em;">ot accessible from the network. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_46" style="word-spacing:0.0286em;">u can prevent this by set‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:12.216em;z-index:501;"><span class="stl_154 stl_32 stl_71" style="word-spacing:0.0496em;">ting the SSH process</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0437em;">s </span><span class="stl_170 stl_171 stl_28">oom_ad</span><span class="stl_170 stl_171 stl_272">j</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0437em;">or </span><span class="stl_170 stl_171 stl_28">oom_score_ad</span><span class="stl_170 stl_171 stl_272">j</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0437em;">value. When working with dedica‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:13.266em;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0973em;">ted database servers, we highly recommend that you identify any key processes like &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:14.316em;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0651em;">MySQL and SSH and proactively adjust the OOM killer score to prevent those from &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:15.366em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0014em;">being selected first for termination. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:16.916em;z-index:790;"><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_72" style="word-spacing:0.0161em;">u can solve most swapping problems by configuring your MySQL buffers correctly, &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:17.966em;z-index:822;"><span class="stl_154 stl_32 stl_51" style="word-spacing:0.0286em;">but sometimes the operating system</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0208em;">s </span><span class="stl_154 stl_32 stl_28">v</span><span class="stl_154 stl_32 stl_74" style="word-spacing:0.0223em;">irtual memory system decides to swap MySQL &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:19.016em;"><span class="stl_154 stl_32 stl_38" style="word-spacing:0.1271em;">anyway, sometimes related to how nonuniform memory access (NUMA) works</span><sup style="top: -0.2917em;"><a href="MultiPageHTML_out113.html#113_0"><span class="stl_166 stl_32 stl_28" style="word-spacing:0.3843em;">3 </span></a></sup><span class="stl_154 stl_32 stl_28">in &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:20.066em;"><span class="stl_154 stl_32 stl_83" style="word-spacing:0.2687em;">Linux. This usually happens when the operating system sees a lot of I/O from &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:21.116em;z-index:1047;"><span class="stl_154 stl_32 stl_38" style="word-spacing:0.076em;">MySQL, so it tries to increase the file cache to hold more data. If there</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0712em;">s </span><span class="stl_154 stl_32 stl_28">n</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0712em;">ot enough &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:22.166em;"><span class="stl_154 stl_32 stl_120" style="word-spacing:0.2127em;">memory, something must be swapped out, and that something might be MySQL &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:23.216em;"><span class="stl_154 stl_32 stl_83" style="word-spacing:0.1317em;">itself. Some older Linux kernel versions also have counterproductive priorities that &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:24.266em;"><span class="stl_154 stl_32 stl_132" style="word-spacing:0.1508em;">swap things when they shouldn’t, but this has been alleviated a bit in more recent &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:25.316em;"><span class="stl_154 stl_32 stl_28">kernels. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:26.866em;z-index:1332;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.2164em;">Operating systems usually allow some control over virtual memory and I/O. </span><span class="stl_154 stl_32 stl_337">W</span><span class="stl_154 stl_32 stl_337">e &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:27.916em;"><span class="stl_154 stl_32 stl_97" style="word-spacing:0.0447em;">mention a few ways to control them on GNU/Linux. The most basic is to change the &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:29.0041em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0967em;">value of </span><span class="stl_155 stl_41 stl_150" style="word-spacing:0.1045em;">/proc/sys/vm/swappiness </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0967em;">to a low value, such as </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1592em;">0 </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0967em;">or </span><span class="stl_170 stl_171 stl_28">1</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0967em;">. This tells the kernel &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:30.0655em;z-index:1533;"><span class="stl_154 stl_32 stl_39" style="word-spacing:0.0773em;">not to swap unless the need for virtual memory is extreme. For example, here</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0738em;">s </span><span class="stl_154 stl_32 stl_28">h</span><span class="stl_154 stl_32 stl_28">ow &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:31.1155em;"><span class="stl_154 stl_32 stl_57" style="word-spacing:0.0021em;">to check the current value: &nbsp;</span></div>
					<div class="stl_01" style="left:7.4167em;top:32.8773em;"><span class="stl_200 stl_171 stl_28">$ </span><span class="stl_265 stl_173 stl_28">cat /proc/sys/vm/swappiness &nbsp;</span></div>
					<div class="stl_01" style="left:7.4167em;top:33.7281em;"><span class="stl_200 stl_171 stl_28">60 &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:34.8655em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.1013em;">The value shown, 60, is the default swappiness setting (the range is from 0 to 100). &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:35.9155em;z-index:1693;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.0437em;">This is a very bad default for servers. It</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0416em;">s </span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_95" style="word-spacing:0.0434em;">nly appropriate for laptops. Servers should &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:37.0149em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">be set to </span><span class="stl_170 stl_171 stl_28">0</span><span class="stl_154 stl_32 stl_28">: &nbsp;</span></div>
					<div class="stl_01" style="left:7.4168em;top:38.7768em;"><span class="stl_200 stl_171 stl_28">$ </span><span class="stl_265 stl_173 stl_28">echo 0 &gt; /proc/sys/vm/swappiness &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:39.9149em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0512em;">Another option is to change how the storage engines read and write data. For exam‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:41.0143em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1515em;">ple, using </span><span class="stl_170 stl_171 stl_28" style="word-spacing:-0.1016em;">innodb_flush_method=O_DIRECT </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1515em;">relieves I/O pressure. Direct I/O is not &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:42.0643em;"><span class="stl_154 stl_32 stl_38" style="word-spacing:0.0099em;">cached, so the operating system doesn’t see it as a reason to increase the size of the file &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:43.1143em;"><span class="stl_154 stl_32 stl_88" style="word-spacing:0.0011em;">cache. This parameter works only for InnoDB. &nbsp;</span></div>
					<div class="stl_01" style="left:6.095em;top:48.2703em;"><span class="stl_167 stl_32 stl_28">3</span></div>
					<div class="stl_01" style="left:6.6667em;top:48.1878em;"><span class="stl_168 stl_32 stl_28" style="word-spacing:0em;">See </span><a href="https://oreil.ly/VGW65" target="_blank"><span class="stl_187 stl_32 stl_28" style="word-spacing:0em;">this blog post </span></a><span class="stl_168 stl_32 stl_28" style="word-spacing:0em;">for more. &nbsp;</span></div>
					<div class="stl_01" style="left:28.314em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">Choosing a Filesystem &nbsp;</span></div>
					<div class="stl_01" style="left:34.4805em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:35.388em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">91 &nbsp;</span></div>
					<a name="113_0" style="position:absolute;left:0em;top:48.2792em;">&nbsp;</a>
					<a name="113_1" style="position:absolute;left:0em;top:19.2453em;">&nbsp;</a>
					<a name="113_2" style="position:absolute;left:0em;top:8.1958em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>
<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_30.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_30.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:6em;top:4.1653em;"><span class="stl_180 stl_27 stl_28" style="word-spacing:0em;">Optimization and Execution &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:6.065em;"><span class="stl_154 stl_32 stl_97" style="word-spacing:0.0199em;">MySQL parses queries to create an internal structure (the parse tree) and then applies &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:7.115em;"><span class="stl_154 stl_32 stl_57" style="word-spacing:0.1489em;">a variety of optimizations. These can include rewriting the query, determining the &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:8.165em;z-index:234;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0477em;">order in which it will read tables, choosing which indexes to use, and so on. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0477em;">u can &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:9.215em;"><span class="stl_154 stl_32 stl_57" style="word-spacing:0.2618em;">pass hints to the optimizer through special keywords in the query, affecting its &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:10.265em;z-index:331;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0.1435em;">decision-making process. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_112" style="word-spacing:0.1418em;">u can also ask the server to explain various aspects of &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:11.315em;"><span class="stl_154 stl_32 stl_87" style="word-spacing:0.0263em;">optimization. This lets you know what decisions the server is making and gives you a &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:12.365em;"><span class="stl_154 stl_32 stl_37" style="word-spacing:0.0539em;">reference point for reworking queries, schemas, and settings to make everything run &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:13.415em;"><span class="stl_154 stl_32 stl_88" style="word-spacing:0.001em;">as efficiently as possible. There is more detail on this in </span><a href="MultiPageHTML_out213.html#213_0"><span class="stl_184 stl_32 stl_24" style="word-spacing:0.0054em;">Chapter 8</span></a><span class="stl_154 stl_32 stl_24" style="word-spacing:0.0054em;">. &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:14.965em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.018em;">The optimizer does not really care what storage engine a particular table uses, but the &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:16.015em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.0191em;">storage engine does affect how the server optimizes the query. The optimizer asks the &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:17.065em;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0212em;">storage engine about some of its capabilities and the cost of certain operations as well &nbsp;</span></div>
					<div class="stl_01" style="left:5.9998em;top:18.115em;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.1113em;">as for statistics on the table data. For instance, some storage engines support index &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:19.165em;z-index:907;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0289em;">types that can be helpful to certain queries. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0276em;">u can read more about schema optimi‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:20.215em;"><span class="stl_154 stl_32 stl_39" style="word-spacing:0.0035em;">zation and indexing in Chapters </span><a href="MultiPageHTML_out147.html#147_0"><span class="stl_184 stl_32 stl_28" style="word-spacing:0em;">6 </span></a><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">and </span><a href="MultiPageHTML_out177.html#177_0"><span class="stl_184 stl_32 stl_28">7</span></a><span class="stl_154 stl_32 stl_28">. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:21.7651em;"><span class="stl_154 stl_32 stl_117" style="word-spacing:0.0329em;">In older versions, MySQL made use of an internal query cache to see if it could serve &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:22.8151em;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.0388em;">the results from there. However, as concurrency increased, the query cache became a &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:23.8651em;"><span class="stl_154 stl_32 stl_140" style="word-spacing:0.0678em;">notorious bottleneck. As of MySQL 5.7.20, the query cache was officially deprecated &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:24.9151em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.1238em;">as a MySQL feature, and in the 8.0 release, the query cache is fully removed. Even &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:25.9651em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.1202em;">though the query cache is no longer a core part of the MySQL server, caching fre‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:27.0151em;"><span class="stl_154 stl_32 stl_37" style="word-spacing:0.0783em;">quently served result sets is a good practice. While outside the scope of this book, a &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:28.0651em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.0019em;">popular design pattern is to cache data in memcached or Redis. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9993em;top:29.9616em;"><span class="stl_159 stl_27 stl_28" style="word-spacing:0em;">Concurrency Control &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:32.2318em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0142em;">Any time more than one query needs to change data at the same time, the problem of &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:33.2818em;"><span class="stl_154 stl_32 stl_120" style="word-spacing:0.0324em;">concurrency control arises. For our purposes in this chapter, MySQL has to do this at &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:34.3318em;z-index:1645;"><span class="stl_154 stl_32 stl_188" style="word-spacing:0.0411em;">two levels: the server level and the storage-engine level. </span><span class="stl_154 stl_32 stl_52">W</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0426em;">e </span><span class="stl_154 stl_32 stl_28">w</span><span class="stl_154 stl_32 stl_83" style="word-spacing:0.0449em;">ill give you a simplified &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:35.3818em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.071em;">overview of how MySQL deals with concurrent readers and writers, so you have the &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:36.4318em;z-index:1772;"><span class="stl_154 stl_32 stl_124" style="word-spacing:0.007em;">context you need for the rest of this chapter. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:37.9818em;"><span class="stl_154 stl_32 stl_105" style="word-spacing:0.2978em;">To </span><span class="stl_154 stl_32 stl_28">i</span><span class="stl_154 stl_32 stl_48" style="word-spacing:0.1054em;">llustrate how MySQL handles concurrent work on the same set of data, we will &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:39.0318em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.0946em;">use a traditional spreadsheet file as an example. A spreadsheet consists of rows and &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:40.0818em;"><span class="stl_154 stl_32 stl_57" style="word-spacing:0.0593em;">columns, much like a database table. Assume the file is on your laptop and only you &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:41.1318em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0679em;">have access to it. There are no potential conflicts; only you can make changes to the &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:42.1818em;"><span class="stl_154 stl_32 stl_120" style="word-spacing:0.0674em;">file. Now, imagine you need to collaborate with a coworker on that spreadsheet. It is &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:43.2318em;"><span class="stl_154 stl_32 stl_77" style="word-spacing:0.0561em;">now on a shared server that both of you have access to. What happens when both of &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:44.2818em;"><span class="stl_154 stl_32 stl_77" style="word-spacing:0.12em;">you need to make changes to this file at the same time? What if we have an entire &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:45.3318em;"><span class="stl_154 stl_32 stl_189" style="word-spacing:0.0989em;">team of people actively trying to edit, add, and remove cells from this spreadsheet? &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:46.3818em;z-index:2387;"><span class="stl_154 stl_32 stl_52" style="word-spacing:0.2604em;">We </span><span class="stl_154 stl_32 stl_28">c</span><span class="stl_154 stl_32 stl_97" style="word-spacing:0.0694em;">an say that they should take turns making changes, but that is not efficient. </span><span class="stl_154 stl_32 stl_52">W</span><span class="stl_154 stl_32 stl_52">e &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:47.4318em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0014em;">need an approach for allowing concurrent access to a high-volume spreadsheet. &nbsp;</span></div>
					<div class="stl_01" style="left:29.092em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">Concurrency Control &nbsp;</span></div>
					<div class="stl_01" style="left:34.7867em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:35.6942em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">3</span></div>
					<a name="25_0" style="position:absolute;left:0em;top:4.4583em;">&nbsp;</a>
					<a name="25_1" style="position:absolute;left:0em;top:30.3132em;">&nbsp;</a>
					<a name="25_2" style="position:absolute;left:0em;top:32.461em;">&nbsp;</a>
					<a name="25_3" style="position:absolute;left:0em;top:28.2943em;">&nbsp;</a>
					<a name="25_4" style="position:absolute;left:0em;top:21.9943em;">&nbsp;</a>
					<a name="25_5" style="position:absolute;left:0em;top:6.2943em;">&nbsp;</a>
					<a name="25_6" style="position:absolute;left:0em;top:15.1943em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>
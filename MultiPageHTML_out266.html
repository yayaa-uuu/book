<!DOCTYPE html><!--[if IE]>  <html class="stl_ie"> <![endif]-->
<html>
	<head>
		<meta charset="utf-8" />
		<title>
		</title>
		<link rel="stylesheet" type="text/css" href="MultiPageHTML_out_files/style.css" />
	</head>
	<body>
		<div class="stl_ stl_02">
			<div class="stl_03">
				<object data="MultiPageHTML_out_files/img_288.svg" type="image/svg+xml" class="stl_04" style="position:absolute; width:42em; height:55.0833em;">
					<embed src="MultiPageHTML_out_files/img_288.svg" type="image/svg+xml" />
				</object>
			</div>
			<div class="stl_view">
				<div class="stl_05 stl_06">
					<div class="stl_01" style="left:6em;top:4.3166em;"><span class="stl_154 stl_32 stl_39" style="word-spacing:0.0292em;">to do kernel updates or security patching 16 times. Automating this task to gracefully &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:5.3666em;"><span class="stl_154 stl_32 stl_78" style="word-spacing:0.0387em;">depool a node, perform patching, reboot, and repool will reduce the amount of work &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:6.4166em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">you do by hand in the future. &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:8.3009em;"><span class="stl_180 stl_27 stl_28" style="word-spacing:0em;">Discouraged Topologies &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:10.2007em;"><span class="stl_154 stl_32 stl_43" style="word-spacing:0.1454em;">By using either of the two recommendations we’ve given in this chapter, you keep &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:11.2507em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.098em;">your topology simple and easy to understand. There are a number of other sugges‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:12.3007em;"><span class="stl_154 stl_32 stl_158" style="word-spacing:0.0463em;">tions from earlier editions of this book, or perhaps you anecdotally heard about how &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:13.3507em;z-index:430;"><span class="stl_154 stl_32 stl_99" style="word-spacing:0.0664em;">another company</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0599em;">s </span><span class="stl_154 stl_32 stl_28">t</span><span class="stl_154 stl_32 stl_88" style="word-spacing:0.0608em;">opology is set up. </span><span class="stl_154 stl_32 stl_52">W</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0599em;">e </span><span class="stl_154 stl_32 stl_28">c</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0599em;">all out some of these here as discouraged &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:14.4007em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.0018em;">because they come with more risk and complexity than we like to see. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:16.4576em;"><span class="stl_193 stl_27 stl_28" style="word-spacing:0em;">Dual source in active-active mode &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:17.9136em;"><span class="stl_155 stl_41 stl_136" style="word-spacing:0.0939em;">Dual source replication </span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.0769em;">(also known as </span><span class="stl_155 stl_41 stl_50" style="word-spacing:0.0946em;">bidirectional replication</span><span class="stl_154 stl_32 stl_125" style="word-spacing:0.0761em;">) involves two servers, &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:18.975em;"><span class="stl_154 stl_32 stl_88" style="word-spacing:0.0304em;">each configured as both a source and a replica of the other—in other words, a pair of &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:20.025em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">cosources. </span><a href="MultiPageHTML_out266.html#266_1"><span class="stl_184 stl_32 stl_28" style="word-spacing:0em;">Figure 9-6 </span></a><span class="stl_154 stl_32 stl_123" style="word-spacing:0.0053em;">shows the setup. &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:26.2995em;"><span class="stl_155 stl_41 stl_215" style="word-spacing:0.0123em;">Figure 9-6. Dual source in active-active mode &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:28.3609em;"><span class="stl_154 stl_32 stl_143" style="word-spacing:0.1431em;">At first glance, this doesn’t look any different than active/passive with two servers, &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:29.4109em;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0741em;">except that replication is already configured in the opposite direction. The real dan‐ &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:30.4609em;"><span class="stl_154 stl_32 stl_28" style="word-spacing:0em;">ger is when you explicitly send write traffic to both sides, hence the active/active part. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:31.9995em;"><span class="stl_154 stl_32 stl_54" style="word-spacing:0.062em;">Active/active is </span><span class="stl_155 stl_41 stl_254" style="word-spacing:0.0453em;">very </span><span class="stl_154 stl_32 stl_38" style="word-spacing:0.0628em;">difficult to do correctly. Some strategies involve choosing which &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:33.0609em;"><span class="stl_154 stl_32 stl_74" style="word-spacing:0.1419em;">side to send to based on even/odd hashing. This ensures that reads-after-write are &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:34.1109em;"><span class="stl_154 stl_32 stl_38" style="word-spacing:0.0881em;">consistent for the same row, but queries that include rows that are canonical on the &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:35.1609em;"><span class="stl_154 stl_32 stl_33" style="word-spacing:0.0458em;">other side may not be consistent. Said more plainly, reading rows with ID 1, 3, and 5 &nbsp;</span></div>
					<div class="stl_01" style="left:6.0002em;top:36.2109em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.2044em;">from one side will always be consistent. What about a query that reads ID 1–6? &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:37.2609em;"><span class="stl_154 stl_32 stl_73" style="word-spacing:0.0428em;">Where do you send that query? What if an update exists on the other side that is not &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:38.3109em;"><span class="stl_154 stl_32 stl_53" style="word-spacing:0.0013em;">reflected on this one due to replication lag? &nbsp;</span></div>
					<div class="stl_01" style="left:5.9997em;top:39.8609em;z-index:1449;"><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_77" style="word-spacing:0.0561em;">u also need to carefully balance capacity. In a cosource scenario, each server is the &nbsp;</span></div>
					<div class="stl_01" style="left:6.0004em;top:40.9109em;z-index:1578;"><span class="stl_154 stl_32 stl_448" style="word-spacing:0.0432em;">other server</span><span class="stl_154 stl_32 stl_34">’</span><span class="stl_154 stl_32 stl_28" style="word-spacing:0.049em;">s </span><span class="stl_154 stl_32 stl_28">r</span><span class="stl_154 stl_32 stl_36" style="word-spacing:0.0529em;">eplica and the most likely target of the failover. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_48" style="word-spacing:0.0526em;">u have to plan your &nbsp;</span></div>
					<div class="stl_01" style="left:6.0001em;top:41.9609em;z-index:1663;"><span class="stl_154 stl_32 stl_123" style="word-spacing:0.0739em;">capacity in a way that ensures that when you shift traffic from one side to the other, &nbsp;</span></div>
					<div class="stl_01" style="left:5.9999em;top:43.0109em;z-index:1685;"><span class="stl_154 stl_32 stl_81" style="word-spacing:0.0163em;">you do not run out of CPU. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_71" style="word-spacing:0.0105em;">u’re also failing over and introducing an entirely differ‐ &nbsp;</span></div>
					<div class="stl_01" style="left:5.9996em;top:44.0609em;"><span class="stl_154 stl_32 stl_97" style="word-spacing:0.1369em;">ent working set of data. The InnoDB buffer pool now churns, removing entries to &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:45.1109em;"><span class="stl_154 stl_32 stl_95" style="word-spacing:0.0018em;">make room for the new hot set of data. &nbsp;</span></div>
					<div class="stl_01" style="left:6.0003em;top:46.6609em;z-index:1833;"><span class="stl_154 stl_32 stl_127">T</span><span class="stl_154 stl_32 stl_28">a</span><span class="stl_154 stl_32 stl_129" style="word-spacing:0.0631em;">ke our advice and stay away from this one. It may feel like you’re getting “use” out &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:47.7109em;z-index:1963;"><span class="stl_154 stl_32 stl_37" style="word-spacing:0.1477em;">of a passive server by having it handle traffic instead of sitting idle. </span><span class="stl_154 stl_32 stl_109">Y</span><span class="stl_154 stl_32 stl_28">o</span><span class="stl_154 stl_32 stl_46" style="word-spacing:0.1508em;">u’ll end up &nbsp;</span></div>
					<div class="stl_01" style="left:6em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">244 &nbsp;</span></div>
					<div class="stl_01" style="left:7.668em;top:50.8098em;"><span class="stl_80 stl_27 stl_28">|</span></div>
					<div class="stl_01" style="left:8.5755em;top:50.8098em;"><span class="stl_80 stl_27 stl_28" style="word-spacing:0em;">Chapter 9: Replication &nbsp;</span></div>
					<a name="266_0" style="position:absolute;left:0em;top:8.594em;">&nbsp;</a>
					<a name="266_1" style="position:absolute;left:0em;top:21.7168em;">&nbsp;</a>
					<a name="266_2" style="position:absolute;left:0em;top:18.1543em;">&nbsp;</a>
					<a name="266_3" style="position:absolute;left:0em;top:10.4299em;">&nbsp;</a>
				</div>
			</div>
		</div>
	</body>
</html>